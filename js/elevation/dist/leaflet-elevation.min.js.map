{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../src/options.js","../src/control.js","../src/index.js"],"sourcesContent":["/**\n * TODO: exget computed styles of theese values from actual \"CSS vars\"\n **/\nexport const Colors = {\n\t'lightblue': { area: '#3366CC', alpha: 0.45, stroke: '#3366CC' },\n\t'magenta'  : { area: '#FF005E' },\n\t'yellow'   : { area: '#FF0' },\n\t'purple'   : { area: '#732C7B' },\n\t'steelblue': { area: '#4682B4' },\n\t'red'      : { area: '#F00' },\n\t'lime'     : { area: '#9CC222', line: '#566B13' }\n};\n\nconst SEC  = 1000;\nconst MIN  = SEC * 60;\nconst HOUR = MIN * 60;\nconst DAY  = HOUR * 24;\n\n/**\n * Convert a time (millis) to a human readable duration string (%Dd %H:%M'%S\")\n */\nexport function formatTime(t) {\n\tlet d = Math.floor(t / DAY);\n\tlet h = Math.floor( (t - d * DAY) / HOUR);\n\tlet m = Math.floor( (t - d * DAY - h * HOUR) / MIN);\n\tlet s = Math.round( (t - d * DAY - h * HOUR - m * MIN) / SEC);\n\tif ( s === 60 ) { m++; s = 0; }\n\tif ( m === 60 ) { h++; m = 0; }\n\tif ( h === 24 ) { d++; h = 0; }\n\treturn (d ? d + \"d \" : '') + h.toString().padStart(2, 0) + ':' + m.toString().padStart(2, 0) + \"'\" + s.toString().padStart(2, 0) + '\"';\n}\n\n/**\n * Convert a time (millis) to human readable date string (dd-mm-yyyy hh:mm:ss)\n */\n export function formatDate(format) {\n\tif (!format) {\n\t\treturn (time) => (new Date(time)).toLocaleString().replaceAll('/', '-').replaceAll(',', ' ');\n\t} else if (format == 'time') {\n\t\treturn (time) => (new Date(time)).toLocaleTimeString();\n\t} else if (format == 'date') {\n\t\treturn (time) => (new Date(time)).toLocaleDateString();\n\t}\n\treturn (time) => format(time);\n}\n\n/**\n * Generate download data event.\n */\n export function saveFile(dataURI, fileName) {\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\n\tlet b = document.body;\n\tb.appendChild(a);\n\ta.click();\n\tb.removeChild(a);\n}\n\n\n/**\n * Convert SVG Path into Path2D and then update canvas\n */\n export function drawCanvas(ctx, path) {\n\tpath.classed('canvas-path', true);\n\n\tctx.beginPath();\n\tctx.moveTo(0, 0);\n\tlet p = new Path2D(path.attr('d'));\n\n\tctx.strokeStyle = path.attr('stroke');\n\tctx.fillStyle   = path.attr('fill');\n\tctx.lineWidth   = 1.25;\n\tctx.globalCompositeOperation = 'source-over';\n\n\t// stroke opacity\n\tctx.globalAlpha = path.attr('stroke-opacity') || 0.3;\n\tctx.stroke(p);\n\n\t// fill opacity\n\tctx.globalAlpha = path.attr('fill-opacity')   || 0.45;\n\tctx.fill(p);\n\n\tctx.globalAlpha = 1;\n\n\tctx.closePath();\n}\n\n/**\n * Loop and extract GPX Extensions handled by \"@tmcw/toGeoJSON\" (eg. \"coordinateProperties\" > \"times\")\n */\nexport function coordPropsToMeta(coordProps, name, parser) {\n\treturn coordProps && (({props, point, id, isMulti }) => {\n\t\tif (props) {\n\t\t\tfor (const key of coordProps) {\n\t\t\t\tif (key in props) {\n\t\t\t\t\tpoint.meta[name] = (parser || parseNumeric).call(this, (isMulti ? props[key][isMulti] : props[key]), id);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\n/**\n * Extract numeric property (id) from GeoJSON object\n */\nexport const parseNumeric  = (property, id) => parseInt((typeof property === 'object' ? property[id] : property));\n\n/**\n * Extract datetime property (id) from GeoJSON object\n */\nexport const parseDate = (property, id) => new Date(Date.parse((typeof property === 'object' ? property[id] : property)));\n\n/**\n * A little bit shorter than L.DomUtil\n */\nexport const addClass      = (n, str)             => n && str.split(\" \").every(s => s && L.DomUtil.addClass(n, s));\nexport const removeClass   = (n, str)             => n && str.split(\" \").every(s => s && L.DomUtil.removeClass(n, s));\nexport const toggleClass   = (n, str, cond)       => (cond ? addClass : removeClass)(n, str);\nexport const replaceClass  = (n, rem, add)        => (rem && removeClass(n, rem)) || (add && addClass(n, add));\nexport const style         = (n, k, v)            => (typeof v === \"undefined\" && L.DomUtil.getStyle(n, k)) || n.style.setProperty(k, v);\nexport const toggleStyle   = (n, k, v, cond)      => style(n, k, cond ? v : '');\nexport const setAttributes = (n, attrs)           => { for (let k in attrs) { n.setAttribute(k, attrs[k]); } };\nexport const toggleEvent   = (el, e, fn, cond)    => el[cond ? 'on' : 'off'](e, fn);\nexport const create        = (tag, str, attrs, n) => { let elem = L.DomUtil.create(tag, str || \"\"); if (attrs) setAttributes(elem, attrs); if (n) append(n, elem); return elem; };\nexport const append        = (n, c)               => n.appendChild(c);\nexport const insert        = (n, c, pos)          => n.insertAdjacentElement(pos, c);\nexport const select        = (str, n)             => (n || document).querySelector(str);\nexport const each          = (obj, fn)            => { for (let i in obj) fn(obj[i], i); };\nexport const randomId      = ()                   => Math.random().toString(36).substr(2, 9);\n\n/**\n * TODO: use generators instead? (ie. \"yield\")\n */\nexport const iMax = (iVal, max = -Infinity) => (iVal > max ? iVal : max); \nexport const iMin = (iVal, min = +Infinity) => (iVal < min ? iVal : min);\nexport const iAvg = (iVal, avg = 0, idx = 1) => (iVal + avg * (idx - 1)) / idx;\nexport const iSum = (iVal, sum = 0) => iVal + sum;\n\n/**\n * Alias for some leaflet core functions\n */\nexport const { on, off }           = L.DomEvent;\nexport const { throttle, wrapNum } = L.Util;\nexport const { hasClass }          = L.DomUtil;\n\n/**\n * Limit floating point precision\n */\nexport const round        = L.Util.formatNum;\n\n/**\n * Limit a number between min / max values\n */\nexport const clamp     = (val, range)           => range ? (val < range[0] ? range[0] : val > range[1] ? range[1] : val) : val;\n\n/**\n * Limit a delta difference between two values\n */\nexport const wrapDelta = (curr, prev, deltaMax) => Math.abs(curr - prev) > deltaMax ? prev + deltaMax * Math.sign(curr - prev) : curr;","import * as _ from './utils';\n\nexport var Options = {\n\tautofitBounds: true,\n\tautohide: false,\n\tautohideMarker: true,\n\talmostover: true,\n\taltitude: true,\n\tcloseBtn: true,\n\tcollapsed: false,\n\tdetached: true,\n\tdistance: true,\n\tdistanceMarkers: { lazy: true, distance: true, direction: true },\n\tdragging: !L.Browser.mobile,\n\tdownloadLink: 'link',\n\televationDiv: \"#elevation-div\",\n\tfollowMarker: true,\n\timperial: false,\n\tlegend: true,\n\thandlers: [\"Distance\", \"Time\", \"Altitude\", \"Slope\", \"Speed\", \"Acceleration\"],\n\thotline: 'elevation',\n\tmarker: 'elevation-line',\n\tmarkerIcon: L.divIcon({\n\t\tclassName: 'elevation-position-marker',\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\n\t\ticonSize: [32, 32],\n\t\ticonAnchor: [16, 16],\n\t}),\n\tposition: \"topright\",\n\tpolyline: {\n\t\tclassName: 'elevation-polyline',\n\t\tcolor: '#000',\n\t\topacity: 0.75,\n\t\tweight: 5,\n\t\tlineCap: 'round'\n\t},\n\tpolylineSegments: {\n\t\tclassName: 'elevation-polyline-segments',\n\t\tcolor: '#F00',\n\t\tinteractive: false,\n\t},\n\tpreferCanvas: false,\n\treverseCoords: false,\n\truler: true,\n\ttheme: \"lightblue-theme\",\n\tsummary: 'inline',\n\tslope: false,\n\tspeed: false,\n\ttime: true,\n\ttimeFactor: 3600,\n\ttimestamps: false,\n\ttrkStart: { className: 'start-marker', radius: 6, weight: 2, color: '#fff', fillColor: '#00d800', fillOpacity: 1, interactive: false },\n\ttrkEnd: { className: 'end-marker', radius: 6, weight: 2, color: '#fff', fillColor: '#ff0606', fillOpacity: 1, interactive: false },\n\twaypoints: true,\n\twptIcons: {\n\t\t'': L.divIcon({\n\t\t\tclassName: 'elevation-waypoint-marker',\n\t\t\thtml: '<i class=\"elevation-waypoint-icon default\"></i>',\n\t\t\ticonSize: [30, 30],\n\t\t\ticonAnchor: [8, 30],\n\t\t}),\n\t},\n\twptLabels: true,\n\txAttr: \"dist\",\n\txLabel: \"km\",\n\tyAttr: \"z\",\n\tyLabel: \"m\",\n\tzFollow: false,\n\tzooming: !L.Browser.Mobile,\n\n\t// Quite uncommon and undocumented options\n\tmargins: { top: 30, right: 30, bottom: 30, left: 40 },\n\theight: (screen.height * 0.3) || 200,\n\twidth: (screen.width * 0.6) || 600,\n\txTicks: undefined,\n\tyTicks: undefined,\n\n\tdecimalsX: 2,\n\tdecimalsY: 0,\n\tforceAxisBounds: false,\n\tinterpolation: \"curveLinear\",\n\tskipNullZCoords: false,\n\tyAxisMax: undefined,\n\tyAxisMin: undefined,\n};\n","import * as _      from './utils';\nimport { Options } from './options';\n\n// \"leaflet-i18n\" fallback\nif (!L._ || !L.i18n) {\n\tL._ = L.i18n = (string, data) => string;\n}\n\n// Prevent CORS issues for relative locations (dynamic import)\nconst baseURL = ((document.currentScript && document.currentScript.src) || (import.meta && import.meta.url)).split(\"/\").slice(0,-1).join(\"/\") + '/';\n\nexport const Elevation = L.Control.Elevation = L.Control.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\toptions: Options,\n\t__mileFactor:     0.621371, // 1 km = (0.621371 mi)\n\t__footFactor:     3.28084,  // 1 m  = (3.28084 ft)\n\t__D3:            'https://unpkg.com/d3@6.5.0/dist/d3.min.js',\n\t__TOGEOJSON:     'https://unpkg.com/@tmcw/togeojson@4.6.0/dist/togeojson.umd.js',\n\t__LGEOMUTIL:     'https://unpkg.com/leaflet-geometryutil@0.9.3/src/leaflet.geometryutil.js',\n\t__LALMOSTOVER:   'https://unpkg.com/leaflet-almostover@1.0.1/src/leaflet.almostover.js',\n\t__LHOTLINE:      '../libs/leaflet-hotline.min.js',\n\t__LDISTANCEM:    '../libs/leaflet-distance-marker.min.js',\n\t__LCHART:        '../src/components/chart.js',\n\t__LMARKER:       '../src/components/marker.js',\n\t__LSUMMARY:      '../src/components/summary.js',\n\t__modulesFolder: '../src/handlers/',\n\t__btnIcon:       '../images/elevation.svg',\n\n\t/*\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\n\t */\n\taddData: function(d, layer) {\n\t\tthis.import(this.__D3)\n\t\t\t.then(() => {\n\t\t\t\tif (this._modulesLoaded) {\n\t\t\t\t\tlayer = layer ?? (d.on && d);\n\t\t\t\t\tthis._addData(d);\n\t\t\t\t\tthis._addLayer(layer);\n\t\t\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\n\t\t\t\t} else {\n\t\t\t\t\tthis.once('modules_loaded', () => this.addData(d,layer));\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\t/**\n\t * Adds the control to the given map.\n\t */\n\taddTo: function(map) {\n\t\tif (this.options.detached) {\n\t\t\tlet parent = _.select(this.options.elevationDiv);\n\t\t\tlet eleDiv = this.onAdd(map);\n\t\t\tparent ? _.append(parent, eleDiv) : _.insert(map.getContainer(), eleDiv, 'afterend');\n\t\t} else {\n\t\t\tL.Control.prototype.addTo.call(this, map);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/*\n\t * Reset data and display\n\t */\n\tclear: function() {\n\t\tif (this._marker)        this._marker.remove();\n\t\tif (this._chart)         this._clearChart();\n\t\tif (this._layers)        this._clearLayers(this._layers);\n\t\tif (this._markers)       this._clearLayers(this._markers);\n\t\tif (this._circleMarkers) this._circleMarkers.remove();\n\t\tif (this._hotline)       this._clearLayers(this._hotline);\n\n\t\tthis._data      = [];\n\t\tthis.track_info = {};\n\n\t\tthis._fireEvt(\"eledata_clear\");\n\n\t\tthis._updateChart();\n\t},\n\n\t_clearChart: function() {\n\t\tif (this._events && this._events.elechart_updated) {\n\t\t\tthis._events.elechart_updated.forEach(({fn, ctx}) => this.off('elechart_updated', fn, ctx));\n\t\t}\n\t\tif (this._chart && this._chart._container) {\n\t\t\tthis._chart._container.selectAll('g.point .point').remove();\n\t\t\tthis._chart.clear();\n\t\t}\n\t},\n\n\t_clearLayers: function(l) {\n\t\tl = l || this._layers;\n\t\tif (l && l.eachLayer) {\n\t\t\tl.eachLayer(f => f.remove())\n\t\t\tl.clearLayers();\n\t\t}\n\t},\n\n\t/**\n\t * TODO: Create a base class to handle custom data attributes (heart rate, cadence, temperature, ...)\n\t * \n\t * @link https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n\t */\n\t// addHandler: function (name, HandlerClass) {\n\t// \tif (HandlerClass) {\n\t// \t\tlet handler = this[name] = new HandlerClass(this);\n\t// \t\tthis.handlers.push(handler);\n\t// \t\tif (this.options[name]) {\n\t// \t\t\thandler.enable();\n\t// \t\t}\n\t// \t}\n\t// \treturn this;\n\t// },\n\n\t/**\n\t * Disable chart brushing.\n\t */\n\tdisableBrush: function() {\n\t\tthis._chart._brushEnabled = false;\n\t\tthis._resetDrag();\n\t},\n\n\t/**\n\t * Enable chart brushing.\n\t */\n\tenableBrush: function() {\n\t\tthis._chart._brushEnabled = true;\n\t},\n\n\t/**\n\t * Disable chart zooming.\n\t */\n\tdisableZoom: function() {\n\t\tthis._chart._zoomEnabled = false;\n\t\tthis._chart._resetZoom();\n\t},\n\n\t/**\n\t * Enable chart zooming.\n\t */\n\tenableZoom: function() {\n\t\tthis._chart._zoomEnabled = true;\n\t},\n\n\t/**\n\t * Sets a map view that contains the given geographical bounds.\n\t */\n\tfitBounds: function(bounds) {\n\t\tbounds = bounds || this.getBounds();\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\n\t},\n\n\tgetBounds: function(data) {\n\t\treturn L.latLngBounds((data || this._data).map((d) => d.latlng));\n\t},\n\n\t/**\n\t * Get default zoom level (followMarker: true).\n\t */\n\tgetZFollow: function() {\n\t\treturn this.options.zFollow;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\thide: function() {\n\t\t_.style(this._container, \"display\", \"none\");\n\t},\n\n\t/**\n\t * Initialize chart control \"options\" and \"container\".\n\t */\n\tinitialize: function(opts) {\n\n\t\topts = L.setOptions(this, opts);\n\n\t\tthis._data           = [];\n\t\tthis._layers         = L.featureGroup();\n\t\tthis._markers        = L.featureGroup();\n\t\tthis._hotline        = L.featureGroup();\n\t\tthis._circleMarkers  = L.featureGroup();\n\t\tthis._markedSegments = L.polyline([]);\n\t\tthis._start          = L.circleMarker([0,0], (opts.trkStart || Options.trkStart));\n\t\tthis._end            = L.circleMarker([0,0], (opts.trkEnd || Options.trkEnd));\n\t\tthis._chartEnabled   = true;\n\t\tthis._yCoordMax      = -Infinity;\n\t\tthis.track_info      = {};\n\t\t//  this.handlers        = [];\n\n\t\tif (opts.followMarker)             this._setMapView = _.throttle(this._setMapView, 300, this);\n\t\tif (opts.legend)                   opts.margins.bottom += 30;\n\t\tif (opts.theme)                    opts.polylineSegments.className += ' ' + opts.theme;\n\t\tif (opts.wptIcons === true)        opts.wptIcons = Options.wptIcons;\n\t\tif (opts.distanceMarkers === true) opts.distanceMarkers = Options.distanceMarkers;\n\t\tif (opts.trkStart)                 this._start.addTo(this._circleMarkers);\n\t\tif (opts.trkEnd)                   this._end.addTo(this._circleMarkers);\n\n\n\t\tthis._markedSegments.setStyle(opts.polylineSegments);\n\n\t\t// Leaflet canvas renderer colors\n\t\tL.extend(_.Colors, opts.colors || {});\n\n\t\t// Various stuff\n\t\tthis._fixCanvasPaths();\n\t\tthis._fixTooltipSize();\n\n\t},\n\n\t/**\n\t * Javascript scripts downloader (lazy loader)\n\t */\n\timport: function(src, condition) {\n\t\tswitch(src) {\n\t\t\tcase this.__D3:          condition = typeof d3 !== 'object'; break;\n\t\t\tcase this.__TOGEOJSON:   condition = typeof toGeoJSON !== 'object'; break;\n\t\t\tcase this.__LGEOMUTIL:   condition = typeof L.GeometryUtil !== 'object'; break;\n\t\t\tcase this.__LALMOSTOVER: condition = typeof L.Handler.AlmostOver  !== 'function'; break;\n\t\t\tcase this.__LDISTANCEM:  condition = typeof L.DistanceMarkers  !== 'function'; break;\n\t\t\tcase this.__LHOTLINE:    condition = typeof L.Hotline  !== 'function'; break;\n\t\t}\n\t\tsrc = (src.startsWith('../') || src.startsWith('./') ? baseURL : '') + src;\n\t\treturn condition !== false ? import(src) : Promise.resolve();\n\t},\n\n\t/**\n\t * Load elevation data (GPX, GeoJSON, KML or TCX).\n\t */\n\tload: function(data) {\n\t\tthis._parseFromString(data).then( geojson => geojson ? this._loadLayer(geojson) : this._loadFile(data));\n\t},\n\n\t/**\n\t * Create container DOM element and related event listeners.\n\t * Called on control.addTo(map).\n\t */\n\tonAdd: function(map) {\n\t\tthis._map = map;\n\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control \" + this.options.theme + \" \" + (this.options.detached ? 'elevation-detached' : 'leaflet-control'), this.options.detached ? { id: 'elevation-' + _.randomId() } : {});\n\n\t\tif (!this.eleDiv) this.eleDiv = container;\n\n\t\tthis._loadModules(this.options.handlers).then(() => { // Inject here required modules (data handlers)\n\t\t\tthis._initChart(container);\n\t\t\tthis._initButton(container);\n\t\t\tthis._initSummary(container);\n\t\t\tthis._initMarker(map);\n\t\t\tthis._initLayer(map);\n\t\t\tthis._modulesLoaded = true;\n\t\t\tthis.fire('modules_loaded');\n\t\t});\n\n\t\tthis.fire('add');\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Clean up control code and related event listeners.\n\t * Called on control.remove().\n\t */\n\tonRemove: function(map) {\n\t\tthis._container = null;\n\n\t\tmap\n\t\t\t.off('zoom viewreset zoomanim',      this._hideMarker,    this)\n\t\t\t.off('resize',                       this._resetView,     this)\n\t\t\t.off('resize',                       this._resizeChart,   this)\n\t\t\t.off('mousedown',                    this._resetDrag,     this);\n\n\t\t_.off(map.getContainer(), 'mousewheel',  this._resetDrag,     this);\n\t\t_.off(map.getContainer(), 'touchstart',  this._resetDrag,     this);\n\t\t_.off(document,           'keydown',     this._onKeyDown,     this);\n\n\t\tthis\n\t\t\t.off('eledata_added eledata_loaded', this._updateChart,   this)\n\t\t\t.off('eledata_added eledata_loaded', this._updateSummary, this);\n\n\t\tthis.fire('remove');\n\t},\n\n\t/**\n\t * Redraws the chart control. Sometimes useful after screen resize.\n\t */\n\tredraw: function() {\n\t\tthis._resizeChart();\n\t},\n\n\t/**\n\t * Set default zoom level (followMarker: true).\n\t */\n\tsetZFollow: function(zoom) {\n\t\tthis.options.zFollow = zoom;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\tshow: function() {\n\t\t_.style(this._container, \"display\", \"block\");\n\t},\n\n\t/*\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\n\t */\n\t_addData: function(d) {\n\t\tif (!d) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Standard GeoJSON\n\t\tif (d.type === \"FeatureCollection\" ) {\n\t\t\treturn _.each(d.features, feature => this._addData(feature));\n\t\t} else if (d.type === \"Feature\") {\n\t\t\tlet geom = d.geometry;\n\t\t\tif (geom) {\n\t\t\t\tswitch (geom.type) {\n\t\t\t\t\tcase 'LineString':\t\treturn this._addGeoJSONData(geom.coordinates, d.properties);\n\t\t\t\t\tcase 'MultiLineString':\treturn _.each(geom.coordinates, (coords, i) => this._addGeoJSONData(coords, d.properties, i));\n\t\t\t\t\tcase 'Point':\n\t\t\t\t\tdefault:\t\t\t\treturn console.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback for leaflet layers (eg. L.Gpx)\n\t\tif (d._latlngs) {\n\t\t\treturn this._addGeoJSONData(d._latlngs, d.feature && d.feature.properties);\n\t\t}\n\n\t},\n\n\t/*\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\n\t */\n\t_addGeoJSONData: function(coords, properties, nestingLevel) {\n\n\t\t// \"coordinateProperties\" property is generated inside \"@tmcw/toGeoJSON\"\n\t\tlet props  = (properties && properties.coordinateProperties) || properties;\n\n\t\tcoords.forEach((point, i) => {\n\n\t\t\t// GARMIN_EXTENSIONS = [\"hr\", \"cad\", \"atemp\", \"wtemp\", \"depth\", \"course\", \"bearing\"];\n\t\t\tpoint.meta = point.meta ?? { time: null, ele: null };\n\t\t\t\n\t\t\tpoint.prev = (attr) => (attr ? this._data[i > 0 ? i - 1 : 0][attr] : this._data[i > 0 ? i - 1 : 0]);\n\n\t\t\tthis.fire(\"elepoint_init\", { point: point, props: props, id: i, isMulti: nestingLevel });\n\n\t\t\tthis._addPoint(\n\t\t\t\tpoint.lat ?? point[1], \n\t\t\t\tpoint.lng ?? point[0],\n\t\t\t\tpoint.alt ?? point.meta.ele ?? point[2]\n\t\t\t);\n\n\t\t\tthis.fire(\"elepoint_added\", { point: point, index: this._data.length - 1 });\n\n\t\t\tif (this._yCoordMax < this._data[this._data.length - 1][this.options.yAttr]) this._yCoordMax = this._data[this._data.length - 1][this.options.yAttr];\n\t\t});\n\n\t\tthis.fire(\"eletrack_added\", { coords: coords, index: this._data.length - 1 });\n\t},\n\n\t/*\n\t * Parse and push a single (x, y, z) point to current elevation profile.\n\t */\n\t_addPoint: function(x, y, z) {\n\t\tif (this.options.reverseCoords) {\n\t\t\t[x, y] = [y, x];\n\t\t}\n\n\t\tthis._data.push({\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tz: z,\n\t\t\tlatlng: L.latLng(x, y, z)\n\t\t});\n\n\t\tthis.fire(\"eledata_updated\", { index: this._data.length - 1 });\n\t},\n\n\t_addLayer: function(layer) {\n\t\tif (layer) this._layers.addLayer(layer)\n\t\t// Postpone adding the distance markers (lazy: true)\n\t\tif (layer && this.options.distanceMarkers && this.options.distanceMarkers.lazy) {\n\t\t\tlayer.on('add remove', ({target, type}) => L.DistanceMarkers && target instanceof L.Polyline && target[type + 'DistanceMarkers']());\n\t\t}\n\t\treturn layer;\n\t},\n\n\t_addMarker: function(marker) {\n\t\tif (marker) this._markers.addLayer(marker)\n\t\treturn marker;\n\t},\n\n\t/**\n\t * Initialize \"L.AlmostOver\" integration\n\t */\n\t_initAlmostOverHandler: function(map, layer) {\n\t\treturn (map && this.options.almostOver && !L.Browser.mobile) ? Promise.all([\n\t\t\tthis.import(this.__LGEOMUTIL),\n\t\t\tthis.import(this.__LALMOSTOVER)\n\t\t]).then(() => {\n\t\t\tmap.addHandler('almostOver', L.Handler.AlmostOver)\n\t\t\tif (L.GeometryUtil && map.almostOver && map.almostOver.enabled()) {\n\t\t\t\tmap.almostOver.addLayer(layer);\n\t\t\t\tmap\n\t\t\t\t\t.on('almost:move', (e) => this._onMouseMoveLayer(e))\n\t\t\t\t\t.on('almost:out',  (e) => this._onMouseOut(e));\n\t\t\t}\n\t\t}) : Promise.resolve();\n\t},\n\n\t/**\n\t * Initialize \"L.DistanceMarkers\" integration\n\t */\n\t_initDistanceMarkers: function() {\n\t\treturn this.options.distanceMarkers ? Promise.all([this.import(this.__LGEOMUTIL), this.import(this.__LDISTANCEM)]) : Promise.resolve();\n\t},\n\n\t_initHotLine: function(layer) {\n\t\tlet prop = typeof this.options.hotline == 'string' ? this.options.hotline : 'elevation';\n\t\treturn this.options.hotline ? this.import(this.__LHOTLINE)\n\t\t\t.then(() => {\n\t\t\t\tlayer.eachLayer((trkseg) => {\n\t\t\t\t\tif(trkseg.feature.geometry.type != \"Point\") {\n\t\t\t\t\t\tlet geo = L.geoJson(trkseg.toGeoJSON(), { coordsToLatLng: (coords) => L.latLng(coords[0], coords[1], coords[2] * (this.options.altitudeFactor || 1))});\n\t\t\t\t\t\tlet line = L.hotline(geo.toGeoJSON().features[0].geometry.coordinates, {\n\t\t\t\t\t\t\trenderer: L.Hotline.renderer(),\n\t\t\t\t\t\t\tmin: isFinite(this.track_info[prop + '_min']) ? this.track_info[prop + '_min'] : 0,\n\t\t\t\t\t\t\tmax: isFinite(this.track_info[prop + '_max']) ? this.track_info[prop + '_max'] : 1,\n\t\t\t\t\t\t\tpalette: {\n\t\t\t\t\t\t\t\t0.0: '#008800',\n\t\t\t\t\t\t\t\t0.5: '#ffff00',\n\t\t\t\t\t\t\t\t1.0: '#ff0000'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tweight: 5,\n\t\t\t\t\t\t\toutlineColor: '#000000',\n\t\t\t\t\t\t\toutlineWidth: 1\n\t\t\t\t\t\t}).addTo(this._hotline);\n\t\t\t\t\t\tlet alpha = trkseg.options.style && trkseg.options.style.opacity || 1;\n\t\t\t\t\t\ttrkseg.on('add remove', ({type}) => {\n\t\t\t\t\t\t\ttrkseg.setStyle({opacity: (type == 'add' ? 0 : alpha)});\n\t\t\t\t\t\t\tline[(type == 'add' ? 'addTo' : 'removeFrom')](trkseg._map);\n\t\t\t\t\t\t\tif (line._renderer) line._renderer._container.parentElement.insertBefore(line._renderer._container, line._renderer._container.parentElement.firstChild);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}) : Promise.resolve();\n\t},\n\n\t/**\n\t * Initialize \"L.AlmostOver\" and \"L.DistanceMarkers\"\n\t */\n\t_initMapIntegrations: function(layer) {\n\t\tlet map = this._map;\n\t\tif (map) {\n\t\t\tif (this._data.length) {\n\t\t\t\tthis._start.setLatLng(this._data[0].latlng);\n\t\t\t\tthis._end.setLatLng(this._data[this._data.length -1].latlng);\n\t\t\t}\n\t\t\tPromise.all([\n\t\t\t\tthis._initHotLine(layer),\n\t\t\t\tthis._initAlmostOverHandler(map, layer),\n\t\t\t\tthis._initDistanceMarkers(),\n\t\t\t]).then(() => {\n\t\t\t\tif\t(this.options.polyline) {\n\t\t\t\t\tlayer.addTo(map);\n\t\t\t\t\tthis._circleMarkers.addTo(map);\n\t\t\t\t}\n\t\t\t\tif (this.options.autofitBounds) {\n\t\t\t\t\tthis.fitBounds(layer.getBounds());\n\t\t\t\t}\n\t\t\t\tmap.invalidateSize();\n\t\t\t});\n\t\t} else {\n\t\t\tthis.once('add', () => this._initMapIntegrations(layer));\n\t\t}\n\t},\n\n\t/*\n\t * Collapse current chart control.\n\t */\n\t_collapse: function() {\n\t\t_.replaceClass(this._container, 'elevation-expanded', 'elevation-collapsed');\n\t\tif (this._map) this._map.invalidateSize();\n\t},\n\n\t/*\n\t * Expand current chart control.\n\t */\n\t_expand: function() {\n\t\t_.replaceClass(this._container, 'elevation-collapsed', 'elevation-expanded');\n\t\tif (this._map) this._map.invalidateSize();\n\t},\n\n\t/**\n\t * Add some basic colors to leaflet canvas renderer (preferCanvas: true).\n\t */\n\t_fixCanvasPaths: function() {\n\t\tlet oldProto = L.Canvas.prototype._fillStroke;\n\t\tlet control  = this;\n\n\t\tlet theme      = this.options.theme.split(' ')[0].replace('-theme', '');\n\t\tlet color      = _.Colors[theme] || {};\n\n\t\tL.Canvas.include({\n\t\t\t_fillStroke: function(ctx, layer) {\n\t\t\t\tif (control._layers.hasLayer(layer)) {\n\n\t\t\t\t\tlet options    = layer.options;\n\n\t\t\t\t\toptions.color  = color.line || color.area || theme;\n\t\t\t\t\toptions.stroke = !!options.color;\n\n\t\t\t\t\toldProto.call(this, ctx, layer);\n\n\t\t\t\t\tif (options.stroke && options.weight !== 0) {\n\t\t\t\t\t\tlet oldVal                   = ctx.globalCompositeOperation || 'source-over';\n\t\t\t\t\t\tctx.globalCompositeOperation = 'destination-over'\n\t\t\t\t\t\tctx.strokeStyle              = color.outline || '#FFF';\n\t\t\t\t\t\tctx.lineWidth                = options.weight * 1.75;\n\t\t\t\t\t\tctx.stroke();\n\t\t\t\t\t\tctx.globalCompositeOperation = oldVal;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\toldProto.call(this, ctx, layer);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Partial fix for initial tooltip size\n\t * \n\t * @link https://github.com/Raruto/leaflet-elevation/issues/81#issuecomment-713477050\n\t */\n\t_fixTooltipSize: function() {\n\t\tthis.on('elechart_init', () =>\n\t\t\tthis.once('elechart_change elechart_hover', ({data, xCoord}) => {\n\t\t\t\tif (this._chartEnabled) {\n\t\t\t\t\tthis._chart._showDiagramIndicator(data, xCoord);\n\t\t\t\t\tthis._chart._showDiagramIndicator(data, xCoord);\n\t\t\t\t}\n\t\t\t\tthis._updateMarker(data);\n\t\t\t})\n\t\t);\n\t},\n\n\t/*\n\t * Finds a data entry for the given LatLng\n\t */\n\t_findItemForLatLng: function(latlng) {\n\t\treturn this._data[this._chart._findIndexForLatLng(latlng)];\n\t},\n\n\t/*\n\t * Finds a data entry for the given xDiagCoord\n\t */\n\t_findItemForX: function(x) {\n\t\treturn this._data[this._chart._findIndexForXCoord(x)];\n\t},\n\n\t/**\n\t * Fires an event of the specified type.\n\t */\n\t_fireEvt: function(type, data, propagate) {\n\t\tif (this.fire) this.fire(type, data, propagate);\n\t\tif (this._map) this._map.fire(type, data, propagate);\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\t_hideMarker: function() {\n\t\tif (this.options.autohideMarker) {\n\t\t\tthis._marker.remove();\n\t\t}\n\t},\n\n\t/**\n\t * Generate \"svg\" chart (DOM element).\n\t */\n\t_initChart: function(container) {\n\t\tlet opts = this.options;\n\t\tlet map  = this._map;\n\n\t\tif (opts.detached) {\n\t\t\tlet { offsetWidth, offsetHeight}             = this.eleDiv;\n\t\t\tif (offsetWidth > 0)             opts.width  = offsetWidth;\n\t\t\tif (offsetHeight > 20)           opts.height = offsetHeight - 20; // 20 = horizontal scrollbar size.\n\t\t} else {\n\t\t\tlet { clientWidth }                          = map.getContainer();\n\t\t\topts._maxWidth                               = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\n\t\t\tthis._container.style.maxWidth               = opts._maxWidth + 'px';\n\t\t\tif (opts._maxWidth > clientWidth) opts.width = clientWidth - 30;\n\t\t}\n\n\t\tPromise.all([\n\t\t\tthis.import(this.__D3),\n\t\t\tthis.import(this.__LCHART)\n\t\t]).then((m) => {\n\n\t\t\tlet chart = this._chart = new (m[1] || Elevation).Chart(opts, this);\n\t\n\t\t\tthis._x     = this._chart._x;\n\t\t\tthis._y     = this._chart._y;\n\t\n\t\t\td3\n\t\t\t\t.select(container)\n\t\t\t\t.call(chart.render())\n\t\n\t\t\tchart\n\t\t\t\t.on('reset_drag',      this._hideMarker,     this)\n\t\t\t\t.on('mouse_enter',     this._onMouseEnter,   this)\n\t\t\t\t.on('dragged',         this._onDragEnd,      this)\n\t\t\t\t.on('mouse_move',      this._onMouseMove,    this)\n\t\t\t\t.on('mouse_out',       this._onMouseOut,     this)\n\t\t\t\t.on('ruler_filter',    this._onRulerFilter,  this)\n\t\t\t\t.on('zoom',            this._updateChart,    this)\n\t\t\t\t.on('elepath_toggle',  this._onToggleChart,  this)\n\t\t\t\t.on('margins_updated', this._resizeChart,    this);\n\t\n\t\n\t\t\tthis.fire(\"elechart_init\");\n\n\t\t\tmap\n\t\t\t\t.on('zoom viewreset zoomanim',      this._hideMarker,    this)\n\t\t\t\t.on('resize',                       this._resetView,     this)\n\t\t\t\t.on('resize',                       this._resizeChart,   this)\n\t\t\t\t.on('rotate',                       this._rotateMarker,  this)\n\t\t\t\t.on('mousedown',                    this._resetDrag,     this);\n\n\t\t\t_.on(map.getContainer(), 'mousewheel',  this._resetDrag,     this);\n\t\t\t_.on(map.getContainer(), 'touchstart',  this._resetDrag,     this);\n\t\t\t_.on(document,           'keydown',     this._onKeyDown,     this);\n\n\t\t\tthis\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateChart,   this)\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateSummary, this);\n\n\t\t\tthis._updateChart();\n\t\t\tthis._updateSummary();\n\t\t});\n\n\n\t},\n\n\t_initLayer: function() {\n\t\tthis._layers\n\t\t\t.on('layeradd layerremove', ({layer, type}) => {\n\t\t\t\tlet node  = layer.getElement && layer.getElement();\n\t\t\t\t_.toggleClass(node,  this.options.polyline.className + ' ' + this.options.theme, type == 'layeradd');\n\t\t\t\t_.toggleEvent(layer, \"mousemove\", this._onMouseMoveLayer.bind(this),             type == 'layeradd')\n\t\t\t\t_.toggleEvent(layer, \"mouseout\",  this._onMouseOut.bind(this),                   type == 'layeradd');\n\t\t\t});\n\t},\n\n\t_initMarker: function(map) {\n\t\tlet pane                     = map.getPane('elevationPane');\n\t\tif (!pane) {\n\t\t\tpane = this._pane        = map.createPane('elevationPane', map.getPane('norotatePane') || map.getPane('mapPane'));\n\t\t\tpane.style.zIndex        = 625; // This pane is above markers but below popups.\n\t\t\tpane.style.pointerEvents = 'none';\n\t\t}\n\n\t\tif (this._renderer) this._renderer.remove()\n\t\tthis._renderer               = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\n\n\t\tPromise.all([\n\t\t\tthis.import(this.__D3),\n\t\t\tthis.import(this.__LMARKER)\n\t\t]).then((m) => {\n\t\t\tthis._marker             = new (m[1] || Elevation).Marker(this.options, this);\n\t\t\tthis.fire(\"elechart_marker\");\n\t\t});\n\t},\n\n\t/**\n\t * Inspired by L.Control.Layers\n\t */\n\t_initButton: function(container) {\n\t\tL.DomEvent\n\t\t\t.disableClickPropagation(container)\n\t\t\t.disableScrollPropagation(container);\n\n\t\tthis.options.collapsed ? this._collapse() : this._expand();\n\n\t\tif (this.options.autohide) {\n\t\t\t_.on(container, 'mouseover', this._expand,   this);\n\t\t\t_.on(container, 'mouseout',  this._collapse, this);\n\t\t\tthis._map.on('click', this._collapse, this);\n\t\t}\n\n\t\tif (this.options.closeBtn) {\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle-icon\", { href: '#', title: L._('Elevation'), }, container);\n\t\t\t_.on(link, 'click', L.DomEvent.stop);\n\t\t\t_.on(link, 'click', this._toggle, this);\n\t\t\t_.on(link, 'focus', this._toggle, this);\n\t\t\tfetch(this.__btnIcon).then(r => r.ok && r.text().then(img => link.innerHTML = img));\n\t\t}\n\t},\n\n\t_initSummary: function(container) {\n\t\tthis.import(this.__LSUMMARY).then((m)=>{\n\t\t\tthis._summary = new (m || Elevation).Summary({ summary: this.options.summary }, this);\n\n\t\t\tthis.on('elechart_init', () => {\n\t\t\t\td3.select(container).call(this._summary.render());\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Retrieve data from a remote url (HTTP).\n\t */\n\t_loadFile: function(url) {\n\t\tfetch(url)\n\t\t\t.then((response) => response.text())\n\t\t\t.then((data)     => {\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\n\t\t\t\tthis._parseFromString(data)\n\t\t\t\t\t.then( geojson => geojson && this._loadLayer(geojson));\n\t\t\t}).catch((err) => console.warn(err));\n\t},\n\n\t/**\n\t * Dynamically import only required javascript modules (code splitting)\n\t */\n\t_loadModules: function(handlers) {\n\t\t// First map known classnames (eg. \"Altitude\" --> L.Control.Elevation.Altitude)\n\t\thandlers = handlers.map((h) => typeof h === 'string' && typeof Elevation[h] !== \"undefined\" ? Elevation[h] : h);\n\t\t// Then load optional classes and custom imports (eg. \"Cadence\" --> import('../src/handlers/cadence.js'))\n\t\tlet modules = handlers.map(file => (typeof file === 'string' && this.import(this.__modulesFolder + file.toLowerCase() + '.js')) || (file instanceof Promise && file) || Promise.resolve());\n\t\treturn Promise.all(modules).then((m) => {\n\t\t\t_.each(m, (exported, i) => {\n\t\t\t\tlet fn = exported && Object.keys(exported)[0];\n\t\t\t\tif (fn) {\n\t\t\t\t\thandlers[i] = Elevation[fn] = (Elevation[fn] ?? exported[fn]);\n\t\t\t\t}\n\t\t\t});\n\t\t\t_.each(handlers, h => [\"function\", \"object\"].includes(typeof h) && this._registerHandler(h));\n\t\t});\n\t},\n\n\t/**\n\t * Simple GeoJSON data loader (L.GeoJSON).\n\t */\n\t_loadLayer: function(geojson) {\n\t\tlet { polyline, theme, waypoints, wptIcons, wptLabels, distanceMarkers } = this.options;\n\t\tlet style = L.extend({}, polyline);\n\n\t\tif (theme) {\n\t\t\tstyle.className += ' ' + theme;\n\t\t}\n\n\t\tif (geojson.name) {\n\t\t\tthis.track_info.name = geojson.name;\n\t\t}\n\n\t\tlet layer = L.geoJson(geojson, {\n\t\t\tdistanceMarkers: distanceMarkers,\n\t\t\tstyle: style,\n\t\t\tpointToLayer: (feature, latlng) => {\n\t\t\t\tif (waypoints) {\n\t\t\t\t\tlet { desc, name, sym } = feature.properties;\n\t\t\t\t\tdesc = desc || '';\n\t\t\t\t\tname = name || '';\n\t\t\t\t\t// Handle chart waypoints (dots)\n\t\t\t\t\tif ([true, 'dots'].includes(waypoints)) {\n\t\t\t\t\t\tthis._registerCheckPoint({\n\t\t\t\t\t\t\tlatlng: latlng,\n\t\t\t\t\t\t\tlabel : ([true, 'dots'].includes(wptLabels) ? name : '')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// Handle map waypoints (markers)\n\t\t\t\t\tif ([true, 'markers'].includes(waypoints) && wptIcons != false) {\n\t\t\t\t\t\treturn this._registerMarker({\n\t\t\t\t\t\t\tlatlng : latlng,\n\t\t\t\t\t\t\tsym    : (sym ?? name).replace(' ', '-').replace('\"', '').replace(\"'\", '').toLowerCase(),\n\t\t\t\t\t\t\tcontent: [true, 'markers'].includes(wptLabels) && (name || desc) && decodeURI(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : ''))\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEachFeature: (feature, layer) => feature.geometry && feature.geometry.type != 'Point' && this.addData(feature, layer),\n\t\t});\n\n\t\tthis.import(this.__D3).then(() => {\n\t\t\tthis._initMapIntegrations(layer);\n\t\t\tthis._fireEvt(\"eledata_loaded\", { data: geojson, layer: layer, name: this.track_info.name, track_info: this.track_info });\n\t\t});\n\n\t\treturn layer;\n\t},\n\n\t_onDragEnd: function({ dragstart, dragend}) {\n\t\tthis._hideMarker();\n\t\tthis.fitBounds(L.latLngBounds([dragstart.latlng, dragend.latlng]));\n\n\t\tthis.fire(\"elechart_dragged\");\n\t},\n\n\t_onKeyDown: function({key}) {\n\t\tif(!this.options.detached && key === \"Escape\"){\n\t\t\tthis._collapse()\n\t\t};\n\t},\n\n\t/**\n\t * Trigger mouseenter event.\n\t */\n\t_onMouseEnter: function() {\n\t\tthis.fire('elechart_enter');\n\t},\n\n\t/*\n\t * Handles the moueseover the chart and displays distance and altitude level.\n\t */\n\t_onMouseMove: function({xCoord}) {\n\t\tif (this._chartEnabled && this._data.length) {\n\t\t\tlet item = this._findItemForX(xCoord);\n\t\t\tif (item) {\n\t\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\n\n\t\t\t\tthis._updateMarker(item);\n\t\t\t\tthis._setMapView(item);\n\n\t\t\t\tif (this._map) {\n\t\t\t\t\t_.addClass(this._map.getContainer(), 'elechart-hover');\n\t\t\t\t}\n\n\t\t\t\tthis.fire(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\t\t\tthis.fire(\"elechart_hover\",  { data: item, xCoord: xCoord });\n\t\t\t}\n\t\t}\n\t},\n\n\t/*\n\t * Handles mouseover events of the data layers on the map.\n\t */\n\t_onMouseMoveLayer: function({latlng}) {\n\t\tif (this._data.length) {\n\t\t\tlet item = this._findItemForLatLng(latlng);\n\t\t\tif (item) {\n\t\t\t\tlet xCoord = item.xDiagCoord;\n\t\n\t\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\n\t\n\t\t\t\tthis._updateMarker(item);\n\t\n\t\t\t\tthis.fire(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\t\t}\n\t\t}\n\t},\n\n\t/*\n\t * Handles the moueseout over the chart.\n\t */\n\t_onMouseOut: function() {\n\t\tif (!this.options.detached) {\n\t\t\tthis._hideMarker();\n\t\t\tthis._chart._hideDiagramIndicator();\n\t\t}\n\n\t\tif (this._map) {\n\t\t\t_.removeClass(this._map.getContainer(), 'elechart-hover');\n\t\t}\n\n\t\tthis.fire(\"elechart_leave\");\n\t},\n\n\t/**\n\t * Handles the drag event over the ruler filter.\n\t */\n\t_onRulerFilter: function({coords}) {\n\t\tthis._updateMapSegments(coords);\n\t},\n\n\t/**\n\t * Toggle chart data on legend click\n\t */\n\t_onToggleChart: function({ name, enabled }) {\n\n\t\tthis._chartEnabled = this._chart._hasActiveLayers();\n\n\t\t// toggle layer visibility on empty chart\n\t\tthis._layers.eachLayer(layer => _.toggleClass(layer.getElement && layer.getElement(), this.options.polyline.className + ' ' + this.options.theme, this._chartEnabled));\n\n\t\t// toggle option value (eg. altitude = { 'disabled' || 'enabled' })\n\t\tthis.options[name] = !enabled && this.options[name] == 'disabled' ? 'enabled' : 'disabled';\n\n\t\t// remove marker on empty chart\n\t\tif (!this._chartEnabled) {\n\t\t\tthis._chart._hideDiagramIndicator();\n\t\t\tthis._marker.remove();\n\t\t}\n\t},\n\n\t/**\n\t * Simple GeoJSON Parser\n\t */\n\t_parseFromGeoJSONString: function(data) {\n\t\ttry {\n\t\t\treturn JSON.parse(data);\n\t\t} catch (e) { }\n\t},\n\n\t/**\n\t * Attempt to parse raw response data (GeoJSON or XML > GeoJSON)\n\t */\n\t_parseFromString: function(data) {\n\t\treturn new Promise(resolve =>\n\t\t\tthis.import(this.__TOGEOJSON).then(() => {\n\t\t\t\tlet geojson;\n\t\t\t\ttry {\n\t\t\t\t\tgeojson = this._parseFromXMLString(data.trim());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tgeojson = this._parseFromGeoJSONString(data.toString());\n\t\t\t\t}\n\t\t\t\tif (geojson) {\n\t\t\t\t\tgeojson.name = geojson.name || (this._downloadURL || '').split('/').pop().split('#')[0].split('?')[0];\n\t\t\t\t}\n\t\t\t\tresolve(geojson);\n\t\t\t})\n\t\t);\n\t},\n\n\t/**\n\t * Simple XML Parser (GPX, KML, TCX)\n\t */\n\t_parseFromXMLString: function(data) {\n\t\tif (data.indexOf(\"<\") != 0) {\n\t\t\tthrow 'Invalid XML';\n\t\t}\n\t\tlet xml  = (new DOMParser()).parseFromString(data, \"text/xml\");\n\t\tlet type = xml.documentElement.tagName.toLowerCase(); // \"kml\" or \"gpx\"\n\t\tlet name = xml.getElementsByTagName('name');\n\t\tif (xml.getElementsByTagName('parsererror').length) {\n\t\t\tthrow 'Invalid XML';\n\t\t}\n\t\tif (!(type in toGeoJSON)) {\n\t\t\ttype = xml.documentElement.tagName == \"TrainingCenterDatabase\" ? 'tcx' : 'gpx';\n\t\t}\n\t\tlet geojson  = toGeoJSON[type](xml);\n\t\tgeojson.name = name.length > 0 ? (Array.from(name).find(tag => tag.parentElement.tagName == \"trk\") ?? name[0]).textContent : '';\n\t\treturn geojson;\n\t},\n\n\t/**\n\t * Add chart profile to diagram\n\t */\n\t_registerAreaPath: function(props) {\n\t\tthis.on(\"elechart_init\", () => this._chart._registerAreaPath(props));\n\t},\n\n\t/**\n\t * Add chart grid to diagram\n\t */\n\t_registerAxisGrid: function(props) {\n\t\tthis.on(\"elechart_axis\", () => this._chart._registerAxisGrid(props));\n\t},\n\n\t/**\n\t * Add chart axis to diagram\n\t */\n\t_registerAxisScale: function(props) {\n\t\tthis.on(\"elechart_axis\", () => this._chart._registerAxisScale(props));\n\t},\n\n\t/**\n\t * Add a point of interest over the diagram\n\t */\n\t_registerCheckPoint: function(props) {\n\t\tthis.on(\"elechart_updated\", () => this._chart._registerCheckPoint(props));\n\t},\n\n\n\t/**\n\t * Base handler for iterative track statistics (dist, time, z, slope, speed, acceleration, ...)\n\t */\n\t _registerDataAttribute: function(props) {\n\n\t\t// parse of \"coordinateProperties\" for later usage\n\t\tif (props.coordPropsToMeta) {\n\t\t\tthis.on(\"elepoint_init\", (e) => props.coordPropsToMeta.call(this, e));\n\t\t}\n\n\t\t// prevent excessive variabile instanstations\n\t\tlet i, curr, prev, attr;\n\n\t\t// save here a reference to last used point\n\t\tlet lastValid = null; \n\n\t\t// iteration\n\t\tthis.on(\"elepoint_added\", ({index, point}) => {\n\t\t\ti = index;\n\n\t\t\tprev = curr ?? this._data[i]; // same as: this._data[i > 0 ? i - 1 : i]\n\t\t\tcurr = this._data[i];\n\t\t\tattr = props.attr || props.name;\n\n\t\t\t// check and fix missing data on last added point\n\t\t\tif (props.skipNull === false) {\n\t\t\t\tlet curr = this._data[i][attr];\n\t\t\t\tif(i > 0) {\n\t\t\t\t\tlet prev = this._data[i - 1][attr];\n\t\t\t\t\tif (isNaN(prev)) {\n\t\t\t\t\t\tif (!isNaN(lastValid) && !isNaN(curr)) {\n\t\t\t\t\t\t\tprev   = (lastValid + curr) / 2;\n\t\t\t\t\t\t} else if (!isNaN(lastValid)) {\n\t\t\t\t\t\t\tprev   = lastValid;\n\t\t\t\t\t\t} else if (!isNaN(curr)) {\n\t\t\t\t\t\t\tprev   = curr;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!isNaN(prev)) return this._data.splice(i - 1, 1);\n\t\t\t\t\t\tthis._data[i - 1][attr] = prev;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// update reference to last used point (ie. if it has data)\n\t\t\t\tif (!isNaN(curr)) {\n\t\t\t\t\tlastValid = curr;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// retrieve point value\n\t\t\tcurr[attr] = props.pointToAttr.call(this, point, i);\n\n\t\t\t// update \"track_info\" stats (min, max, avg, ...)\n\t\t\tif (props.stats) {\n\t\t\t\tfor (const key in props.stats) {\n\t\t\t\t\tlet sname = (props.statsName || attr) + (key != '' ? '_' : '');\n\t\t\t\t\tthis.track_info[sname + key] = props.stats[key].call(this, curr[attr], this.track_info[sname + key], this._data.length);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Limit \"crazy\" delta values.\n\t\t\tif (props.deltaMax) {\n\t\t\t\tcurr[attr] =_.wrapDelta(curr[attr], prev[attr], props.deltaMax);\n\t\t\t}\n\t\t\t\n\t\t\t// Range of acceptable values.\n\t\t\tif (props.clampRange) {\n\t\t\t\tcurr[attr] = _.clamp(curr[attr], props.clampRange);\n\t\t\t}\n\n\t\t\t// Limit floating point precision.\n\t\t\tif (!isNaN(props.decimals)) {\n\t\t\t\tcurr[attr] = _.round(curr[attr], props.decimals);\n\t\t\t}\n\n\t\t\t// update here some mixins (eg. complex \"track_info\" stuff)\n\t\t\tif(props.onPointAdded) props.onPointAdded.call(this, curr[attr], i, point);\n\t\t});\n\t},\n\n\t/**\n\t * Parse a module definition and attach related function listeners\n\t */\n\t_registerHandler: function(props) {\n\n\t\t// eg. L.Control.Altitude\n\t\tif (typeof props === \"function\") {\n\t\t\treturn this._registerHandler(props.call(this));\n\t\t}\n\n\t\tlet {\n\t\t\tname,\n\t\t\tattr,\n\t\t\trequired,\n\t\t\tskipNull,\n\t\t\tdeltaMax,\n\t\t\tclampRange,\n\t\t\tdecimals,\n\t\t\tmeta,\n\t\t\tunit,\n\t\t\tcoordinateProperties,\n\t\t\tcoordPropsToMeta,\n\t\t\tpointToAttr,\n\t\t\tonPointAdded,\n\t\t\tstats,\n\t\t\tstatsName,\n\t\t\tgrid,\n\t\t\tscale,\n\t\t\tpath,\n\t\t\ttooltip,\n\t\t\tsummary\n\t\t} = props;\n\n\t\t// eg. \"altitude\" == true\n\t\tif (this.options[name] || required) {\n\n\t\t\tthis._registerDataAttribute({\n\t\t\t\tname,\n\t\t\t\tattr,\n\t\t\t\tskipNull,\n\t\t\t\tdeltaMax,\n\t\t\t\tclampRange,\n\t\t\t\tdecimals,\n\t\t\t\tcoordPropsToMeta: _.coordPropsToMeta(coordinateProperties, meta || name, coordPropsToMeta),\n\t\t\t\tpointToAttr,\n\t\t\t\tonPointAdded,\n\t\t\t\tstats,\n\t\t\t\tstatsName,\n\t\t\t});\n\n\t\t\tif (grid) {\n\t\t\t\tthis._registerAxisGrid(L.extend({ name }, grid));\n\t\t\t}\n\n\t\t\tif (this.options[name] !== \"summary\") {\n\t\t\t\tif (scale) this._registerAxisScale(L.extend({ name, label: unit }, scale));\n\t\t\t\tif (path)  this._registerAreaPath(L.extend({ name }, path));\n\t\t\t}\n\n\t\t\tif (tooltip || props.tooltips) {\n\t\t\t\t_.each([tooltip, ...(props.tooltips || [])], t => t && this._registerTooltip(L.extend({ name }, t)));\n\t\t\t}\n\n\t\t\tif (summary) {\n\t\t\t\t_.each(summary, (s, k) => summary[k] = L.extend({ unit }, s));\n\t\t\t\tthis._registerSummary(summary);\n\t\t\t}\n\t\t}\n\t},\n\n\t_registerMarker({latlng, sym, content}) {\n\t\tlet { wptIcons } = this.options;\n\t\t// generate and cache appropriate icon symbol\n\t\tif (!wptIcons.hasOwnProperty(sym)) {\n\t\t\twptIcons[sym] = L.divIcon(L.extend({}, wptIcons[\"\"].options, { html: '<i class=\"elevation-waypoint-icon ' + sym + '\"></i>' } ));\n\t\t}\n\t\tlet marker = L.marker(latlng, { icon: wptIcons[sym] });\n\t\tif (content) {\n\t\t\tmarker.bindPopup(content, { className: 'elevation-popup', keepInView: true }).openPopup();\n\t\t\tmarker.bindTooltip(content, { className: 'elevation-tooltip', direction: 'auto', sticky: true, opacity: 1 }).openTooltip();\n\t\t}\n\t\treturn this._addMarker(marker)\n\t},\n\t\n\t/**\n\t * Add chart or marker tooltip info\n\t */\n\t_registerTooltip: function(props) {\n\t\tprops.chart  && this.on(\"elechart_init\",   () => this._chart._registerTooltip(L.extend({}, props, { value: props.chart })));\n\t\tprops.marker && this.on(\"elechart_marker\", () => this._marker._registerTooltip(L.extend({}, props, { value: props.marker })));\n\t},\n\n\t/**\n\t * Add summary info to diagram\n\t */\n\t_registerSummary: function(props) {\n\t\tthis.on('elechart_summary',  () => this._summary._registerSummary(props));\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tthis._chart._resetDrag();\n\t\tthis._hideMarker();\n\t},\n\n\t/**\n\t * Resets drag, marker and bounds.\n\t */\n\t_resetView: function() {\n\t\tif (this._map && this._map._isFullscreen) return;\n\t\tthis._resetDrag();\n\t\tthis._hideMarker();\n\t\tif (this.options.autofitBounds) {\n\t\t\tthis.fitBounds();\n\t\t}\n\t},\n\n\t/**\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\n\t */\n\t_resizeChart: function() {\n\t\tif (this._container && _.style(this._container, \"display\") != \"none\") {\n\t\t\tlet opts = this.options;\n\t\t\tlet newWidth = opts.detached ? (this.eleDiv || this._container).offsetWidth : _.clamp(opts._maxWidth, [0, this._map.getContainer().clientWidth - 30]);\n\t\t\tif (newWidth) {\n\t\t\t\topts.width = newWidth;\n\t\t\t\tif (this._chart && this._chart._chart) {\n\t\t\t\t\tthis._chart._chart._resize(opts);\n\t\t\t\t\tthis._updateChart();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._updateMapSegments();\n\t\t}\n\t},\n\n\t/**\n\t * Collapse or Expand chart control.\n\t */\n\t_toggle: function() {\n\t\t_.hasClass(this._container, \"elevation-expanded\") ? this._collapse() : this._expand();\n\t},\n\n\t/**\n\t * Update map center and zoom (followMarker: true)\n\t */\n\t_setMapView: function(item) {\n\t\tif (this._map && this.options.followMarker) {\n\t\t\tlet zoom = this._map.getZoom();\n\t\t\tlet z    = this.options.zFollow;\n\t\t\tif (typeof z === \"number\") {\n\t\t\t\tthis._map.setView(item.latlng, (zoom < z ? z : zoom), { animate: true, duration: 0.25 });\n\t\t\t} else if (!this._map.getBounds().contains(item.latlng)) {\n\t\t\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Calculates [x, y] domain and then update chart.\n\t */\n\t_updateChart: function() {\n\t\tif (this._chart && this._container) {\n\t\t\tthis.fire(\"elechart_axis\");\n\t\n\t\t\tthis._chart.update({ data: this._data, options: this.options });\n\t\n\t\t\tthis._x     = this._chart._x;\n\t\t\tthis._y     = this._chart._y;\n\t\n\t\t\tthis.fire('elechart_updated');\t\t\n\t\t}\n\t},\n\n\t/*\n\t * Update the position/height indicator marker drawn onto the map\n\t */\n\t_updateMarker: function(item) {\n\t\tif (this._marker) {\n\t\t\tthis._marker.update({\n\t\t\t\tmap         : this._map,\n\t\t\t\titem        : item,\n\t\t\t\tyCoordMax   : this._yCoordMax || 0,\n\t\t\t\toptions     : this.options\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Fix marker rotation on rotated maps\n\t */\n\t_rotateMarker: function() {\n\t\tif (this._marker) {\n\t\t\tthis._marker.update();\n\t\t}\n\t},\n\n\t/**\n\t * Highlight track segments on the map.\n\t */\n\t_updateMapSegments: function(coords) {\n\t\tthis._markedSegments.setLatLngs(coords || []);\n\t\tif (coords && this._map && !this._map.hasLayer(this._markedSegments)) {\n\t\t\tthis._markedSegments.addTo(this._map);\n\t\t}\n\t},\n\n\t/**\n\t * Update chart summary.\n\t */\n\t_updateSummary: function() {\n\t\tif (this._summary) {\n\t\t\tthis._summary.reset();\n\t\t\tif (this.options.summary) {\n\t\t\t\tthis.fire(\"elechart_summary\");\n\t\t\t\tthis._summary.update();\n\t\t\t}\n\t\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\n\t\t\t\tthis._summary._container.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\n\t\t\t\t_.select('.download a', this._summary._container).onclick = (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tlet event = { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) };\n\t\t\t\t\tif (this.options.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\n\t\t\t\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: event }));\n\t\t\t\t\t} else if (this.options.downloadLink == 'link' || this.options.downloadLink === true) {\n\t\t\t\t\t\tevent.confirm();\n\t\t\t\t\t}\n\t\t\t\t\tthis.fire('eletrack_download', event);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t},\n\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\tif (this._chart) return this._chart._width();\n\t\tconst { width, margins } = this.options;\n\t\treturn width - margins.left - margins.right;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tif (this._chart) return this._chart._height();\n\t\tconst { height, margins } = this.options;\n\t\treturn height - margins.top - margins.bottom;\n\t},\n\n});\n","/*\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\n *\n *  This file is free software: you may copy, redistribute and/or modify it\n *  under the terms of the GNU General Public License as published by the\n *  Free Software Foundation, either version 2 of the License, or (at your\n *  option) any later version.\n *\n *  This file is distributed in the hope that it will be useful, but\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n *  General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see .\n *\n * This file incorporates work covered by the following copyright and\n * permission notice:\n *\n *     Copyright (c) 2013-2016, MIT License, Felix MrMufflon Bache\n *\n *     Permission to use, copy, modify, and/or distribute this software\n *     for any purpose with or without fee is hereby granted, provided\n *     that the above copyright notice and this permission notice appear\n *     in all copies.\n *\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n */\n\nimport * as _ from './utils';\nimport { Elevation } from './control';\n\nElevation.Utils = _;\n\nL.control.elevation = (options) => new Elevation(options);\n"],"names":["Colors","lightblue","area","alpha","stroke","magenta","yellow","purple","steelblue","red","lime","line","SEC","MIN","HOUR","DAY","saveFile","dataURI","fileName","a","create","href","target","download","style","b","document","body","appendChild","click","removeChild","coordPropsToMeta","coordProps","name","parser","props","point","id","isMulti","key","meta","parseNumeric","call","this","property","parseInt","addClass","n","str","split","every","s","L","DomUtil","removeClass","toggleClass","cond","replaceClass","rem","add","k","v","getStyle","setProperty","setAttributes","attrs","setAttribute","toggleEvent","el","e","fn","tag","elem","append","c","insert","pos","insertAdjacentElement","select","querySelector","each","obj","i","randomId","Math","random","toString","substr","on","off","DomEvent","throttle","wrapNum","Util","hasClass","round","formatNum","clamp","val","range","wrapDelta","curr","prev","deltaMax","abs","sign","t","d","floor","h","m","padStart","format","time","Date","toLocaleTimeString","toLocaleDateString","toLocaleString","replaceAll","ctx","path","classed","beginPath","moveTo","p","Path2D","attr","strokeStyle","fillStyle","lineWidth","globalCompositeOperation","globalAlpha","fill","closePath","parse","iVal","max","Infinity","min","avg","idx","sum","Options","autofitBounds","autohide","autohideMarker","almostover","altitude","closeBtn","collapsed","detached","distance","distanceMarkers","lazy","direction","dragging","Browser","mobile","downloadLink","elevationDiv","followMarker","imperial","legend","handlers","hotline","marker","markerIcon","divIcon","className","html","iconSize","iconAnchor","position","polyline","color","opacity","weight","lineCap","polylineSegments","interactive","preferCanvas","reverseCoords","ruler","theme","summary","slope","speed","timeFactor","timestamps","trkStart","radius","fillColor","fillOpacity","trkEnd","waypoints","wptIcons","wptLabels","xAttr","xLabel","yAttr","yLabel","zFollow","zooming","Mobile","margins","top","right","bottom","left","height","screen","width","xTicks","undefined","yTicks","decimalsX","decimalsY","forceAxisBounds","interpolation","skipNullZCoords","yAxisMax","yAxisMin","_","i18n","string","data","baseURL","currentScript","src","url","URL","baseURI","slice","join","Elevation","Control","extend","includes","Evented","prototype","Mixin","Events","options","__mileFactor","__footFactor","__D3","__TOGEOJSON","__LGEOMUTIL","__LALMOSTOVER","__LHOTLINE","__LDISTANCEM","__LCHART","__LMARKER","__LSUMMARY","__modulesFolder","__btnIcon","addData","layer","import","then","_modulesLoaded","_addData","_addLayer","_fireEvt","track_info","once","addTo","map","parent","_.select","eleDiv","onAdd","_.append","_.insert","getContainer","clear","_marker","remove","_chart","_clearChart","_layers","_clearLayers","_markers","_circleMarkers","_hotline","_data","_updateChart","_events","elechart_updated","forEach","_container","selectAll","l","eachLayer","f","clearLayers","disableBrush","_brushEnabled","_resetDrag","enableBrush","disableZoom","_zoomEnabled","_resetZoom","enableZoom","fitBounds","bounds","getBounds","_map","isValid","latLngBounds","latlng","getZFollow","hide","_.style","initialize","opts","setOptions","featureGroup","_markedSegments","_start","circleMarker","_end","_chartEnabled","_yCoordMax","_setMapView","_.throttle","setStyle","_.Colors","colors","_fixCanvasPaths","_fixTooltipSize","condition","d3","toGeoJSON","GeometryUtil","Handler","AlmostOver","DistanceMarkers","Hotline","startsWith","Promise","resolve","load","_parseFromString","geojson","_loadLayer","_loadFile","container","_.create","_.randomId","_loadModules","_initChart","_initButton","_initSummary","_initMarker","_initLayer","fire","onRemove","_hideMarker","_resetView","_resizeChart","_.off","_onKeyDown","_updateSummary","redraw","setZFollow","zoom","show","type","_.each","features","feature","geom","geometry","_addGeoJSONData","coordinates","properties","coords","console","warn","_latlngs","nestingLevel","coordinateProperties","ele","_addPoint","lat","lng","alt","index","length","x","y","z","push","latLng","addLayer","Polyline","_addMarker","_initAlmostOverHandler","almostOver","all","addHandler","enabled","_onMouseMoveLayer","_onMouseOut","_initDistanceMarkers","_initHotLine","prop","trkseg","geo","geoJson","coordsToLatLng","altitudeFactor","renderer","isFinite","palette","outlineColor","outlineWidth","_renderer","parentElement","insertBefore","firstChild","_initMapIntegrations","setLatLng","invalidateSize","_collapse","_.replaceClass","_expand","oldProto","Canvas","_fillStroke","control","replace","include","hasLayer","oldVal","outline","xCoord","_showDiagramIndicator","_updateMarker","_findItemForLatLng","_findIndexForLatLng","_findItemForX","_findIndexForXCoord","propagate","offsetWidth","offsetHeight","clientWidth","_maxWidth","maxWidth","chart","Chart","_x","_y","render","_onMouseEnter","_onDragEnd","_onMouseMove","_onRulerFilter","_onToggleChart","_rotateMarker","_.on","node","getElement","_.toggleClass","_.toggleEvent","bind","pane","getPane","_pane","createPane","zIndex","pointerEvents","svg","Marker","disableClickPropagation","disableScrollPropagation","link","_button","title","stop","_toggle","fetch","r","ok","text","img","innerHTML","_summary","Summary","response","_downloadURL","catch","err","modules","file","toLowerCase","exported","Object","keys","_registerHandler","pointToLayer","desc","sym","_registerCheckPoint","label","_registerMarker","content","decodeURI","onEachFeature","dragstart","dragend","item","_.addClass","xDiagCoord","_hideDiagramIndicator","_.removeClass","_updateMapSegments","_hasActiveLayers","_parseFromGeoJSONString","JSON","_parseFromXMLString","trim","pop","indexOf","xml","DOMParser","parseFromString","documentElement","tagName","getElementsByTagName","Array","from","find","textContent","_registerAreaPath","_registerAxisGrid","_registerAxisScale","_registerDataAttribute","lastValid","skipNull","isNaN","splice","pointToAttr","stats","sname","statsName","_.wrapDelta","clampRange","_.clamp","decimals","_.round","onPointAdded","required","unit","grid","scale","tooltip","_.coordPropsToMeta","tooltips","_registerTooltip","_registerSummary","hasOwnProperty","icon","bindPopup","keepInView","openPopup","bindTooltip","sticky","openTooltip","value","_isFullscreen","newWidth","_resize","_.hasClass","getZoom","setView","animate","duration","contains","update","yCoordMax","setLatLngs","reset","onclick","preventDefault","event","confirm","_.saveFile","CustomEvent","dispatchEvent","detail","_width","_height","Utils","elevation"],"mappings":"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"}