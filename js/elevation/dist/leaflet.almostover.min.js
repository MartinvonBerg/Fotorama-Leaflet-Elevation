L.Map.mergeOptions({almostOver:!0,almostDistance:25,almostSamplingPeriod:50,almostOnMouseMove:!0}),L.Handler.AlmostOver=L.Handler.extend({includes:L.Evented||L.Mixin.Events,initialize:function(map){var timer;this._map=map,this._layers=[],this._previous=null,this._marker=null,this._buffer=0,this.__mouseMoveSampling=(timer=new Date,function(e){var date=new Date,filtered;date-timer<this._map.options.almostSamplingPeriod||0===this._layers.length||(timer=date,this._map.fire("mousemovesample",{latlng:e.latlng}))})},addHooks:function(){this._map.options.almostOnMouseMove&&(this._map.on("mousemove",this.__mouseMoveSampling,this),this._map.on("mousemovesample",this._onMouseMove,this)),this._map.on("click dblclick",this._onMouseClick,this);var map=this._map;function computeBuffer(){this._buffer=this._map.layerPointToLatLng([0,0]).lat-this._map.layerPointToLatLng([this._map.options.almostDistance,this._map.options.almostDistance]).lat}this._map.on("viewreset zoomend",computeBuffer,this),this._map.whenReady(computeBuffer,this)},removeHooks:function(){this._map.off("mousemovesample"),this._map.off("mousemove",this.__mouseMoveSampling,this),this._map.off("click dblclick",this._onMouseClick,this)},addLayer:function(layer){"function"==typeof layer.eachLayer?layer.eachLayer((function(l){this.addLayer(l)}),this):("function"==typeof this.indexLayer&&this.indexLayer(layer),this._layers.push(layer))},removeLayer:function(layer){if("function"==typeof layer.eachLayer)layer.eachLayer((function(l){this.removeLayer(l)}),this);else{"function"==typeof this.unindexLayer&&this.unindexLayer(layer);var index=this._layers.indexOf(layer);0<=index&&this._layers.splice(index,1)}this._previous=null},getClosest:function(latlng){var snapfunc=L.GeometryUtil.closestLayerSnap,distance=this._map.options.almostDistance,snaplist=[];return snaplist="function"==typeof this.searchBuffer?this.searchBuffer(latlng,this._buffer):this._layers,snapfunc(this._map,snaplist,latlng,distance,!1)},_onMouseMove:function(e){var closest=this.getClosest(e.latlng);closest?(this._previous?L.stamp(this._previous.layer)!=L.stamp(closest.layer)&&(this._map.fire("almost:out",{layer:this._previous.layer}),this._map.fire("almost:over",{layer:closest.layer,latlng:closest.latlng})):this._map.fire("almost:over",{layer:closest.layer,latlng:closest.latlng}),this._map.fire("almost:move",{layer:closest.layer,latlng:closest.latlng})):this._previous&&this._map.fire("almost:out",{layer:this._previous.layer}),this._previous=closest},_onMouseClick:function(e){var closest=this.getClosest(e.latlng);closest&&this._map.fire("almost:"+e.type,{layer:closest.layer,latlng:closest.latlng})}}),void 0!==L.LayerIndexMixin&&L.Handler.AlmostOver.include(L.LayerIndexMixin),L.Map.addInitHook("addHandler","almostOver",L.Handler.AlmostOver);
//# sourceMappingURL=leaflet.almostover.min.js.map