!function(factory){var L;if("function"==typeof define&&define.amd)define(["leaflet"],factory);else if("undefined"!=typeof module)L=require("leaflet"),module.exports=factory(L);else{if(void 0===window.L)throw"Leaflet must be loaded first";factory(window.L)}}((function(L){"use strict";return L.Polyline._flat=L.LineUtil.isFlat||L.Polyline._flat||function(latlngs){return!L.Util.isArray(latlngs[0])||"object"!=typeof latlngs[0][0]&&void 0!==latlngs[0][0]},L.GeometryUtil=L.extend(L.GeometryUtil||{},{distance:function(map,latlngA,latlngB){return map.latLngToLayerPoint(latlngA).distanceTo(map.latLngToLayerPoint(latlngB))},distanceSegment:function(map,latlng,latlngA,latlngB){var p=map.latLngToLayerPoint(latlng),p1=map.latLngToLayerPoint(latlngA),p2=map.latLngToLayerPoint(latlngB);return L.LineUtil.pointToSegmentDistance(p,p1,p2)},readableDistance:function(distance,unit){var isMetric,distanceStr;return distanceStr="imperial"!==unit?distance>1e3?(distance/1e3).toFixed(2)+" km":distance.toFixed(1)+" m":(distance*=1.09361)>1760?(distance/1760).toFixed(2)+" miles":distance.toFixed(1)+" yd"},belongsSegment:function(latlng,latlngA,latlngB,tolerance){tolerance=void 0===tolerance?.2:tolerance;var hypotenuse=latlngA.distanceTo(latlngB),delta;return(latlngA.distanceTo(latlng)+latlng.distanceTo(latlngB)-hypotenuse)/hypotenuse<tolerance},length:function(coords){var accumulated=L.GeometryUtil.accumulatedLengths(coords);return accumulated.length>0?accumulated[accumulated.length-1]:0},accumulatedLengths:function(coords){if("function"==typeof coords.getLatLngs&&(coords=coords.getLatLngs()),0===coords.length)return[];for(var total=0,lengths=[0],i=0,n=coords.length-1;i<n;i++)total+=coords[i].distanceTo(coords[i+1]),lengths.push(total);return lengths},closestOnSegment:function(map,latlng,latlngA,latlngB){var maxzoom=map.getMaxZoom();maxzoom===1/0&&(maxzoom=map.getZoom());var p=map.project(latlng,maxzoom),p1=map.project(latlngA,maxzoom),p2=map.project(latlngB,maxzoom),closest=L.LineUtil.closestPointOnSegment(p,p1,p2);return map.unproject(closest,maxzoom)},closest:function(map,layer,latlng,vertices){var latlngs,mindist=1/0,result=null,i,n,distance,subResult;if(layer instanceof Array){if(layer[0]instanceof Array&&"number"!=typeof layer[0][0]){for(i=0;i<layer.length;i++)(subResult=L.GeometryUtil.closest(map,layer[i],latlng,vertices))&&subResult.distance<mindist&&(mindist=subResult.distance,result=subResult);return result}if(!(layer[0]instanceof L.LatLng||"number"==typeof layer[0][0]||"number"==typeof layer[0].lat))return result;layer=L.polyline(layer)}if(!(layer instanceof L.Polyline))return result;if(latlngs=JSON.parse(JSON.stringify(layer.getLatLngs().slice(0))),layer instanceof L.Polygon){var addLastSegment=function(latlngs){if(L.Polyline._flat(latlngs))latlngs.push(latlngs[0]);else for(var i=0;i<latlngs.length;i++)addLastSegment(latlngs[i])};addLastSegment(latlngs)}if(L.Polyline._flat(latlngs)){if(vertices){for(i=0,n=latlngs.length;i<n;i++){var ll=latlngs[i];(distance=L.GeometryUtil.distance(map,latlng,ll))<mindist&&(mindist=distance,(result=ll).distance=distance)}return result}for(i=0,n=latlngs.length;i<n-1;i++){var latlngA=latlngs[i],latlngB=latlngs[i+1];(distance=L.GeometryUtil.distanceSegment(map,latlng,latlngA,latlngB))<=mindist&&(mindist=distance,(result=L.GeometryUtil.closestOnSegment(map,latlng,latlngA,latlngB)).distance=distance)}return result}for(i=0;i<latlngs.length;i++)(subResult=L.GeometryUtil.closest(map,latlngs[i],latlng,vertices)).distance<mindist&&(mindist=subResult.distance,result=subResult);return result},closestLayer:function(map,layers,latlng){for(var mindist=1/0,result=null,ll=null,distance=1/0,i=0,n=layers.length;i<n;i++){var layer=layers[i];if(layer instanceof L.LayerGroup){var subResult=L.GeometryUtil.closestLayer(map,layer.getLayers(),latlng);subResult.distance<mindist&&(mindist=subResult.distance,result=subResult)}else"function"==typeof layer.getLatLng?(ll=layer.getLatLng(),distance=L.GeometryUtil.distance(map,latlng,ll)):(ll=L.GeometryUtil.closest(map,layer,latlng))&&(distance=ll.distance),distance<mindist&&(mindist=distance,result={layer:layer,latlng:ll,distance:distance})}return result},nClosestLayers:function(map,layers,latlng,n){if((n="number"==typeof n?n:layers.length)<1||layers.length<1)return null;for(var results=[],distance,ll,i=0,m=layers.length;i<m;i++){var layer=layers[i];if(layer instanceof L.LayerGroup){var subResult=L.GeometryUtil.closestLayer(map,layer.getLayers(),latlng);results.push(subResult)}else"function"==typeof layer.getLatLng?(ll=layer.getLatLng(),distance=L.GeometryUtil.distance(map,latlng,ll)):(ll=L.GeometryUtil.closest(map,layer,latlng))&&(distance=ll.distance),results.push({layer:layer,latlng:ll,distance:distance})}return results.sort((function(a,b){return a.distance-b.distance})),results.length>n?results.slice(0,n):results},layersWithin:function(map,layers,latlng,radius){radius="number"==typeof radius?radius:1/0;for(var results=[],ll=null,distance=0,i=0,n=layers.length;i<n;i++){var layer=layers[i];"function"==typeof layer.getLatLng?(ll=layer.getLatLng(),distance=L.GeometryUtil.distance(map,latlng,ll)):(ll=L.GeometryUtil.closest(map,layer,latlng))&&(distance=ll.distance),ll&&distance<radius&&results.push({layer:layer,latlng:ll,distance:distance})}var sortedResults;return results.sort((function(a,b){return a.distance-b.distance}))},closestLayerSnap:function(map,layers,latlng,tolerance,withVertices){tolerance="number"==typeof tolerance?tolerance:1/0,withVertices="boolean"!=typeof withVertices||withVertices;var result=L.GeometryUtil.closestLayer(map,layers,latlng);if(!result||result.distance>tolerance)return null;if(withVertices&&"function"==typeof result.layer.getLatLngs){var closest=L.GeometryUtil.closest(map,result.layer,result.latlng,!0);closest.distance<tolerance&&(result.latlng=closest,result.distance=L.GeometryUtil.distance(map,closest,latlng))}return result},interpolateOnPointSegment:function(pA,pB,ratio){return L.point(pA.x*(1-ratio)+ratio*pB.x,pA.y*(1-ratio)+ratio*pB.y)},interpolateOnLine:function(map,latLngs,ratio){var n=(latLngs=latLngs instanceof L.Polyline?latLngs.getLatLngs():latLngs).length;if(n<2)return null;if(0===(ratio=Math.max(Math.min(ratio,1),0)))return{latLng:latLngs[0]instanceof L.LatLng?latLngs[0]:L.latLng(latLngs[0]),predecessor:-1};if(1==ratio)return{latLng:latLngs[latLngs.length-1]instanceof L.LatLng?latLngs[latLngs.length-1]:L.latLng(latLngs[latLngs.length-1]),predecessor:latLngs.length-2};var maxzoom=map.getMaxZoom();maxzoom===1/0&&(maxzoom=map.getZoom());for(var pts=[],lineLength=0,i=0;i<n;i++)pts[i]=map.project(latLngs[i],maxzoom),i>0&&(lineLength+=pts[i-1].distanceTo(pts[i]));for(var ratioDist=lineLength*ratio,cumulativeDistanceToA=0,cumulativeDistanceToB=0,i=0;cumulativeDistanceToB<ratioDist;i++){var pointA=pts[i],pointB=pts[i+1];cumulativeDistanceToA=cumulativeDistanceToB,cumulativeDistanceToB+=pointA.distanceTo(pointB)}if(null==pointA&&null==pointB)var pointA=pts[0],pointB=pts[1],i=1;var segmentRatio=cumulativeDistanceToB-cumulativeDistanceToA!=0?(ratioDist-cumulativeDistanceToA)/(cumulativeDistanceToB-cumulativeDistanceToA):0,interpolatedPoint=L.GeometryUtil.interpolateOnPointSegment(pointA,pointB,segmentRatio);return{latLng:map.unproject(interpolatedPoint,maxzoom),predecessor:i-1}},locateOnLine:function(map,polyline,latlng){var latlngs=polyline.getLatLngs();if(latlng.equals(latlngs[0]))return 0;if(latlng.equals(latlngs[latlngs.length-1]))return 1;for(var point=L.GeometryUtil.closest(map,polyline,latlng,!1),lengths=L.GeometryUtil.accumulatedLengths(latlngs),total_length=lengths[lengths.length-1],portion=0,found=!1,i=0,n=latlngs.length-1;i<n;i++){var l1=latlngs[i],l2=latlngs[i+1];if(portion=lengths[i],L.GeometryUtil.belongsSegment(point,l1,l2,.001)){portion+=l1.distanceTo(point),found=!0;break}}if(!found)throw"Could not interpolate "+latlng.toString()+" within "+polyline.toString();return portion/total_length},reverse:function(polyline){return L.polyline(polyline.getLatLngs().slice(0).reverse())},extract:function(map,polyline,start,end){if(start>end)return L.GeometryUtil.extract(map,L.GeometryUtil.reverse(polyline),1-start,1-end);start=Math.max(Math.min(start,1),0),end=Math.max(Math.min(end,1),0);var latlngs=polyline.getLatLngs(),startpoint=L.GeometryUtil.interpolateOnLine(map,polyline,start),endpoint=L.GeometryUtil.interpolateOnLine(map,polyline,end),point;if(start==end)return[L.GeometryUtil.interpolateOnLine(map,polyline,end).latLng];-1==startpoint.predecessor&&(startpoint.predecessor=0),-1==endpoint.predecessor&&(endpoint.predecessor=0);var result=latlngs.slice(startpoint.predecessor+1,endpoint.predecessor+1);return result.unshift(startpoint.latLng),result.push(endpoint.latLng),result},isBefore:function(polyline,other){if(!other)return!1;var lla=polyline.getLatLngs(),llb=other.getLatLngs();return lla[lla.length-1].equals(llb[0])},isAfter:function(polyline,other){if(!other)return!1;var lla=polyline.getLatLngs(),llb=other.getLatLngs();return lla[0].equals(llb[llb.length-1])},startsAtExtremity:function(polyline,other){if(!other)return!1;var lla=polyline.getLatLngs(),llb=other.getLatLngs(),start=lla[0];return start.equals(llb[0])||start.equals(llb[llb.length-1])},computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},computeSlope:function(a,b){var s=(b.y-a.y)/(b.x-a.x),o;return{a:s,b:a.y-s*a.x}},rotatePoint:function(map,latlngPoint,angleDeg,latlngCenter){var maxzoom=map.getMaxZoom();maxzoom===1/0&&(maxzoom=map.getZoom());var angleRad=angleDeg*Math.PI/180,pPoint=map.project(latlngPoint,maxzoom),pCenter=map.project(latlngCenter,maxzoom),x2=Math.cos(angleRad)*(pPoint.x-pCenter.x)-Math.sin(angleRad)*(pPoint.y-pCenter.y)+pCenter.x,y2=Math.sin(angleRad)*(pPoint.x-pCenter.x)+Math.cos(angleRad)*(pPoint.y-pCenter.y)+pCenter.y;return map.unproject(new L.Point(x2,y2),maxzoom)},bearing:function(latlng1,latlng2){var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,lon1=latlng1.lng*rad,lon2=latlng2.lng*rad,y=Math.sin(lon2-lon1)*Math.cos(lat2),x=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1),bearing=(180*Math.atan2(y,x)/Math.PI+360)%360;return bearing>=180?bearing-360:bearing},destination:function(latlng,heading,distance){heading=(heading+360)%360;var rad=Math.PI/180,radInv=180/Math.PI,R=6378137,lon1=latlng.lng*rad,lat1=latlng.lat*rad,rheading=heading*rad,sinLat1=Math.sin(lat1),cosLat1=Math.cos(lat1),cosDistR=Math.cos(distance/R),sinDistR=Math.sin(distance/R),lat2=Math.asin(sinLat1*cosDistR+cosLat1*sinDistR*Math.cos(rheading)),lon2=lon1+Math.atan2(Math.sin(rheading)*sinDistR*cosLat1,cosDistR-sinLat1*Math.sin(lat2));return lon2=(lon2*=radInv)>180?lon2-360:lon2<-180?lon2+360:lon2,L.latLng([lat2*radInv,lon2])},angle:function(map,latlngA,latlngB){var pointA=map.latLngToContainerPoint(latlngA),pointB=map.latLngToContainerPoint(latlngB),angleDeg=180*Math.atan2(pointB.y-pointA.y,pointB.x-pointA.x)/Math.PI+90;return angleDeg+=angleDeg<0?360:0},destinationOnSegment:function(map,latlngA,latlngB,distance){var angleDeg=L.GeometryUtil.angle(map,latlngA,latlngB),latlng=L.GeometryUtil.destination(latlngA,angleDeg,distance);return L.GeometryUtil.closestOnSegment(map,latlng,latlngA,latlngB)}}),L.GeometryUtil}));
//# sourceMappingURL=leaflet.geometryutil.min.js.map