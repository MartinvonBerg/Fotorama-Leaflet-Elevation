!function(factory){"function"==typeof define&&define.amd?define(factory):factory()}((function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function deepMerge(target){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(!sources.length)return target;var source=sources.shift();if(isObject(target)&&isObject(source))for(var key in source)isObject(source[key])?(target[key]||Object.assign(target,_defineProperty({},key,{})),deepMerge(target[key],source[key])):Object.assign(target,_defineProperty({},key,source[key]));return deepMerge.apply(void 0,[target].concat(sources))}function deferFunc(f){"complete"!==document.readyState?window.addEventListener("load",f,{once:!0}):f()}function formatNum(num,dec,sep){return num.toFixed(dec).toString().split(".").join(sep||".")}!function(factory,window){"function"==typeof define&&define.amd?define(["leaflet"],factory):"object"==typeof exports&&(module.exports=factory(require("leaflet"))),void 0!==window&&window.L&&factory(window.L)}((function(L){return L.locales={},L.locale=null,L.registerLocale=function registerLocale(code,locale){L.locales[code]=L.Util.extend({},L.locales[code],locale)},L.setLocale=function setLocale(code){L.locale=code},L.i18n=L._=function translate(string,data){L.locale&&L.locales[L.locale]&&L.locales[L.locale][string]&&(string=L.locales[L.locale][string]);try{string=L.Util.template(string,data)}catch(err){}return string}}),window);var SEC=1e3,MIN=6e4,HOUR=36e5,DAY=864e5;function formatTime(t){var s="";t>=DAY&&(s+=Math.floor(t/DAY)+"d ",t%=DAY),t>=36e5&&(s+=Math.floor(t/36e5)+":",t%=36e5),t>=6e4&&(s+=Math.floor(t/6e4).toString().padStart(2,0)+"'",t%=6e4),t>=1e3&&(s+=Math.floor(t/1e3).toString().padStart(2,0),t%=1e3);var msec=Math.round(1e3*Math.floor(t))/1e3;return msec&&(s+="."+msec.toString().replace(/0+$/,"")),s||(s="0.0"),s+='"'}function GeoJSONLoader(data,control){"string"==typeof data&&(data=JSON.parse(data)),control=control||this;var layer=L.geoJson(data,{style:function style(feature){var style=L.extend({},control.options.polyline);return control.options.theme&&(style.className+=" "+control.options.theme),style},pointToLayer:function pointToLayer(feature,latlng){var marker=L.marker(latlng,{icon:control.options.gpxOptions.marker_options.wptIcons[""]}),desc=feature.properties.desc?feature.properties.desc:"",name=feature.properties.name?feature.properties.name:"";return(name||desc)&&marker.bindPopup("<b>"+name+"</b>"+(desc.length>0?"<br>"+desc:"")).openPopup(),control.fire("waypoint_added",{point:marker,point_type:"waypoint",element:latlng}),marker},onEachFeature:function onEachFeature(feature,layer){"Point"!=feature.geometry.type&&(layer._latlngs.forEach((function(point,i){if(point.meta={time:null,ele:null,hr:null,cad:null,atemp:null},"alt"in point&&(point.meta.ele=point.alt),feature.properties){var prop=feature.properties;"coordTimes"in prop?point.meta.time=new Date(Date.parse(prop.coordTimes[i])):"times"in prop?point.meta.time=new Date(Date.parse(prop.times[i])):"time"in prop&&(point.meta.time=new Date(Date.parse("object"===_typeof(prop.time)?prop.time[i]:prop.time))),"heartRates"in prop?point.meta.hr=parseInt(prop.heartRates[i]):"heartRate"in prop&&(point.meta.hr=parseInt("object"===_typeof(prop.heartRate)?prop.heartRate[i]:prop.heartRate))}})),control.addData(layer),control.track_info=L.extend({},control.track_info,{type:"geojson",name:data.name}))}});return L.Control.Elevation._d3LazyLoader.then((function(){control._fireEvt("eledata_loaded",{data:data,layer:layer,name:control.track_info.name,track_info:control.track_info})})),layer}function GPXLoader(data,control){(control=control||this).options.gpxOptions.polyline_options=L.extend({},control.options.polyline,control.options.gpxOptions.polyline_options),control.options.theme&&(control.options.gpxOptions.polyline_options.className+=" "+control.options.theme);var layer=new L.GPX(data,control.options.gpxOptions);return layer.on("addpoint",(function(e){control.fire("waypoint_added",e)})),layer.on("addline",(function(e){control.addData(e.line),control.track_info=L.extend({},control.track_info,{type:"gpx",name:layer.get_name()})})),layer.once("loaded",(function(e){L.Control.Elevation._d3LazyLoader.then((function(){control._fireEvt("eledata_loaded",{data:data,layer:layer,name:control.track_info.name,track_info:control.track_info})}))})),layer}function isDomVisible(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)}function isObject(item){return item&&"object"===_typeof(item)&&!Array.isArray(item)}function isVisible(elem){if(!elem)return!1;var styles=window.getComputedStyle(elem);function isVisibleByStyles(elem,styles){return"hidden"!==styles.visibility&&"none"!==styles.display}function isAboveOtherElements(elem,styles){var boundingRect=elem.getBoundingClientRect(),left=boundingRect.left+1,right=boundingRect.right-1,top=boundingRect.top+1,bottom=boundingRect.bottom-1,above=!0,pointerEvents=elem.style.pointerEvents;return"none"==styles["pointer-events"]&&(elem.style.pointerEvents="auto"),document.elementFromPoint(left,top)!==elem&&(above=!1),document.elementFromPoint(right,top)!==elem&&(above=!1),elem.style.pointerEvents=pointerEvents,above}return!!isVisibleByStyles(elem,styles)&&!!isAboveOtherElements(elem,styles)}function isJSONDoc(doc,lazy){if(lazy=void 0===lazy||lazy,"string"==typeof doc&&lazy)return 0==(doc=doc.trim()).indexOf("{")||0==doc.indexOf("[");try{JSON.parse(doc.toString())}catch(e){return!("object"!==_typeof(doc)||!lazy)||(console.warn(e),!1)}return!0}function isXMLDoc(doc,lazy){if(lazy=void 0===lazy||lazy,"string"==typeof doc&&lazy)return 0==(doc=doc.trim()).indexOf("<");var documentElement=(doc?doc.ownerDocument||doc:0).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName}function lazyLoader(url,skip,loader){return!1===skip?Promise.resolve():loader instanceof Promise?loader:new Promise((function(resolve,reject){var tag=document.createElement("script");tag.addEventListener("load",resolve,{once:!0}),tag.src=url,document.head.appendChild(tag)}))}function loadFile(url,success){return new Promise((function(resolve,reject){var xhr=new XMLHttpRequest;xhr.responseType="text",xhr.open("GET",url),xhr.onload=function(){return resolve(xhr.response)},xhr.onerror=function(){return reject("Error "+xhr.status+" while fetching remote file: "+url)},xhr.send()}))}function saveFile(dataURI,fileName){var a=create("a","",{href:dataURI,target:"_new",download:fileName||"",style:"display:none;"}),b=document.body;b.appendChild(a),a.click(),b.removeChild(a)}function waitHolder(elem){return new Promise((function(resolve,reject){var ticking=!1,scrollFn=function scrollFn(){ticking||(L.Util.requestAnimFrame((function(){isVisible(elem)&&(window.removeEventListener("scroll",scrollFn),resolve()),ticking=!1})),ticking=!0)};window.addEventListener("scroll",scrollFn),elem&&elem.addEventListener("mouseenter",scrollFn,{once:!0}),scrollFn()}))}function addClass(targetNode,className){targetNode&&className.split(" ").every((function(s){return s&&L.DomUtil.addClass(targetNode,s)}))}function removeClass(targetNode,className){targetNode&&className.split(" ").every((function(s){return s&&L.DomUtil.removeClass(targetNode,s)}))}function toggleClass(targetNode,className,conditional){return(conditional?addClass:removeClass).call(null,targetNode,className)}function style(targetNode,name,value){return void 0===value?L.DomUtil.getStyle(targetNode,name):targetNode.style.setProperty(name,value)}function create(tagName,className,attributes,parent){var elem=L.DomUtil.create(tagName,className||"");return attributes&&setAttributes(elem,attributes),parent&&append(parent,elem),elem}function append(parent,child){return parent.appendChild(child)}function insert(parent,child,position){return parent.insertAdjacentElement(position,child)}function setAttributes(elem,attrs){for(var k in attrs)elem.setAttribute(k,attrs[k])}function select(selector,context){return(context||document).querySelector(selector)}var on=L.DomEvent.on,off=L.DomEvent.off,hasClass=L.DomUtil.hasClass;function randomId(){return Math.random().toString(36).substr(2,9)}function each(obj,fn){for(var i in obj)fn(obj[i],i)}var _=Object.freeze({__proto__:null,deepMerge:deepMerge,deferFunc:deferFunc,formatNum:formatNum,formatTime:formatTime,GeoJSONLoader:GeoJSONLoader,GPXLoader:GPXLoader,isDomVisible:isDomVisible,isObject:isObject,isVisible:isVisible,isJSONDoc:isJSONDoc,isXMLDoc:isXMLDoc,lazyLoader:lazyLoader,loadFile:loadFile,saveFile:saveFile,waitHolder:waitHolder,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,style:style,create:create,append:append,insert:insert,setAttributes:setAttributes,select:select,on:on,off:off,hasClass:hasClass,randomId:randomId,each:each}),Area=function Area(_ref){var data=_ref.data,name=_ref.name,xAttr=_ref.xAttr,yAttr=_ref.yAttr,scaleX=_ref.scaleX,scaleY=_ref.scaleY,height=_ref.height,_ref$interpolation=_ref.interpolation,interpolation=void 0===_ref$interpolation?"curveLinear":_ref$interpolation;return function(path){"string"==typeof interpolation&&(interpolation=d3[interpolation]);var area=d3.area().curve(interpolation).x((function(d){return d.xDiagCoord=scaleX(d[xAttr])})).y0(height).y1((function(d){return scaleY(d[yAttr])}));return data&&path.datum(data).attr("d",area),name&&path.attr("data-name",name),area}},AreaPath=function AreaPath(props){return d3.create("svg:path").attr("class","area").call(Area(props))},Axis=function Axis(_ref2){var _ref2$type=_ref2.type,type=void 0===_ref2$type?"axis":_ref2$type,_ref2$tickSize=_ref2.tickSize,tickSize=void 0===_ref2$tickSize?6:_ref2$tickSize,_ref2$tickPadding=_ref2.tickPadding,tickPadding=void 0===_ref2$tickPadding?3:_ref2$tickPadding,position=_ref2.position,height=_ref2.height,width=_ref2.width,axis=_ref2.axis,scale=_ref2.scale,ticks=_ref2.ticks,tickFormat=_ref2.tickFormat,label=_ref2.label,labelX=_ref2.labelX,labelY=_ref2.labelY,_ref2$name=_ref2.name,name=void 0===_ref2$name?"":_ref2$name;return function(g){var w=0,h=0;"bottom"==position&&(h=height),"right"==position&&(w=width),"x"==axis&&"grid"==type?tickSize=-height:"y"==axis&&"grid"==type&&(tickSize=-width);var axisScale=d3["axis"+position.replace(/\b\w/g,(function(l){return l.toUpperCase()}))]().scale(scale).ticks(ticks).tickPadding(tickPadding).tickSize(tickSize).tickFormat(tickFormat),axisGroup=g.append("g").attr("class",[axis,type,position,name].join(" ")).attr("transform","translate("+w+","+h+")").call(axisScale);return label&&axisGroup.append("text").attr("x",labelX).attr("y",labelY).text(label),axisGroup}},DragRectangle=function DragRectangle(_ref3){var dragStartCoords=_ref3.dragStartCoords,dragEndCoords=_ref3.dragEndCoords,height=_ref3.height;return function(rect){var x1=Math.min(dragStartCoords[0],dragEndCoords[0]),x2=Math.max(dragStartCoords[0],dragEndCoords[0]);return rect.attr("width",x2-x1).attr("height",height).attr("x",x1)}},FocusRect=function FocusRect(_ref4){var width=_ref4.width,height=_ref4.height;return function(rect){return rect.attr("width",width).attr("height",height).style("fill","none").style("stroke","none").style("pointer-events","all")}},Grid=function Grid(props){return props.type="grid",Axis(props)},HeightFocusLine=function HeightFocusLine(_ref5){var theme=_ref5.theme,_ref5$xCoord=_ref5.xCoord,xCoord=void 0===_ref5$xCoord?0:_ref5$xCoord,_ref5$yCoord=_ref5.yCoord,yCoord=void 0===_ref5$yCoord?0:_ref5$yCoord,_ref5$length=_ref5.length,length=void 0===_ref5$length?0:_ref5$length;return function(line){return line.attr("class",theme+" height-focus line").attr("x1",xCoord).attr("x2",xCoord).attr("y1",yCoord).attr("y2",length)}},HeightFocusLabel=function HeightFocusLabel(_ref6){var theme=_ref6.theme,_ref6$xCoord=_ref6.xCoord,xCoord=void 0===_ref6$xCoord?0:_ref6$xCoord,_ref6$yCoord=_ref6.yCoord,yCoord=void 0===_ref6$yCoord?0:_ref6$yCoord,label=_ref6.label;return function(text){text.attr("class",theme+" height-focus-label").style("pointer-events","none").attr("x",xCoord+5).attr("y",yCoord);var y=text.select(".height-focus-y");return y.node()||(y=text.append("svg:tspan")),y.attr("class","height-focus-y").text(label),text.selectAll("tspan").attr("x",xCoord+5),text}},HeightFocusMarker=function HeightFocusMarker(_ref7){var theme=_ref7.theme,_ref7$xCoord=_ref7.xCoord,xCoord=void 0===_ref7$xCoord?0:_ref7$xCoord,_ref7$yCoord=_ref7.yCoord,yCoord=void 0===_ref7$yCoord?0:_ref7$yCoord;return function(circle){return circle.attr("class",theme+" height-focus circle-lower").attr("transform","translate("+xCoord+","+yCoord+")").attr("r",6).attr("cx",0).attr("cy",0)}},LegendItem=function LegendItem(_ref8){var name=_ref8.name,width=_ref8.width,height=_ref8.height,_ref8$margins=_ref8.margins,margins=void 0===_ref8$margins?{}:_ref8$margins;return function(g){return g.attr("class","legend-item legend-"+name.toLowerCase()).attr("data-name",name),g.append("rect").attr("class","area").attr("x",width/2-50).attr("y",height+margins.bottom/2).attr("width",50).attr("height",10).attr("opacity",.75),g.append("text").text(L._(name)).attr("x",width/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",height+margins.bottom/2).attr("dy","0.75em"),g}},MouseFocusLine=function MouseFocusLine(_ref9){var _ref9$xCoord=_ref9.xCoord,xCoord=void 0===_ref9$xCoord?0:_ref9$xCoord,height=_ref9.height;return function(line){return line.attr("class","mouse-focus-line").attr("x2",xCoord).attr("y2",0).attr("x1",xCoord).attr("y1",height)}},MouseFocusLabel=function MouseFocusLabel(_ref10){var xCoord=_ref10.xCoord,yCoord=_ref10.yCoord,_ref10$labelX=_ref10.labelX,labelX=void 0===_ref10$labelX?"":_ref10$labelX,_ref10$labelY=_ref10.labelY,labelY=void 0===_ref10$labelY?"":_ref10$labelY,width=_ref10.width;return function(g){g.attr("class","mouse-focus-label");var rect=g.select(".mouse-focus-label-rect"),text=g.select(".mouse-focus-label-text"),y=text.select(".mouse-focus-label-y"),x=text.select(".mouse-focus-label-x");rect.node()||(rect=g.append("rect")),text.node()||(text=g.append("svg:text")),y.node()||(y=text.append("svg:tspan")),x.node()||(x=text.append("svg:tspan")),y.text(labelY),x.text(labelX);var xAlign=0,yAlign=0,bbox={width:0,height:0};try{bbox=text.node().getBBox()}catch(e){return g}return xCoord&&(xAlign=xCoord+(xCoord<width/2?10:-bbox.width-10)),yCoord&&(yAlign=Math.max(yCoord-bbox.height,L.Browser.webkit?0:-1/0)),rect.attr("class","mouse-focus-label-rect").attr("x",xAlign-5).attr("y",yAlign-5).attr("width",bbox.width+10).attr("height",bbox.height+10).attr("rx",3).attr("ry",3),text.attr("class","mouse-focus-label-text").style("font-weight","700").attr("y",yAlign),y.attr("class","mouse-focus-label-y").attr("dy","1em"),x.attr("class","mouse-focus-label-x").attr("dy","2em"),text.selectAll("tspan").attr("x",xAlign),g}},Ruler=function Ruler(_ref11){var height=_ref11.height,width=_ref11.width;return function(g){return g.data([{x:0,y:height}]).attr("transform",(function(d){return"translate("+d.x+","+d.y+")"})),g.append("line").attr("class","horizontal-drag-line").attr("x1",0).attr("x2",width),g.append("text").attr("class","horizontal-drag-label").attr("text-anchor","end").attr("x",width-8).attr("y",-8),g.selectAll().data([{type:d3.symbolTriangle,x:width+7,y:0,angle:-90,size:50}]).enter().append("path").attr("class","horizontal-drag-symbol").attr("d",d3.symbol().type((function(d){return d.type})).size((function(d){return d.size}))).attr("transform",(function(d){return"translate("+d.x+","+d.y+") rotate("+d.angle+")"})),g}},Scale=function Scale(_ref12){var data=_ref12.data,attr=_ref12.attr,min=_ref12.min,forceBounds=_ref12.forceBounds,range=_ref12.range,domain=data?d3.extent(data,(function(d){return d[attr]})):[0,1];return void 0!==min&&(min<domain[0]||forceBounds)&&(domain[0]=min),"undefined"!=typeof max&&(max>domain[1]||forceBounds)&&(domain[1]=max),d3.scaleLinear().range(range).domain(domain)},Bisect=function Bisect(_ref13){var _ref13$data=_ref13.data,data=void 0===_ref13$data?[0,1]:_ref13$data,scale=_ref13.scale,x=_ref13.x,attr=_ref13.attr;return d3.bisector((function(d){return d[attr]})).left(data,scale.invert(x))},D3=Object.freeze({__proto__:null,Area:Area,AreaPath:AreaPath,Axis:Axis,DragRectangle:DragRectangle,FocusRect:FocusRect,Grid:Grid,HeightFocusLine:HeightFocusLine,HeightFocusLabel:HeightFocusLabel,HeightFocusMarker:HeightFocusMarker,LegendItem:LegendItem,MouseFocusLine:MouseFocusLine,MouseFocusLabel:MouseFocusLabel,Ruler:Ruler,Scale:Scale,Bisect:Bisect}),Chart=L.Class.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,initialize:function initialize(opts){this.options=opts,this._data=[],this._draggingEnabled=opts.dragging,opts.imperial?(this._xLabel="mi",this._yLabel="ft"):(this._xLabel=opts.xLabel,this._yLabel=opts.yLabel),this._xTicks=opts.xTicks,this._yTicks=opts.yTicks;var scale=this._updateScale(),svg=this._container=d3.create("svg").attr("class","background").attr("width",opts.width).attr("height",opts.height),g=svg.append("g").attr("transform","translate("+opts.margins.left+","+opts.margins.top+")").call(this._appendGrid()).call(this._appendArea()).call(this._appendAxis()).call(this._appendFocusable()).call(this._appendLegend()).call(this._appendClipper());this._grid=svg.select(".grid"),this._area=svg.select(".area"),this._path=svg.select(".area path"),this._axis=svg.select(".axis"),this._focus=svg.select(".focus"),this._focusRect=this._focus.select("rect"),this._legend=svg.select(".legend"),this._x=scale.x,this._y=scale.y},update:function update(props){return props.data&&(this._data=props.data),props.options&&(this.options=props.options),this._updateScale(),this._updateAxis(),this._updateArea(),this},render:function render(){var _this=this;return function(container){return container.append((function(){return _this._container.node()}))}},clear:function clear(){this._resetDrag(),this._area.selectAll("path").attr("d","M0 0"),this._path},_updateScale:function _updateScale(){if(this.zooming)return{x:this._x,y:this._y};var opts=this.options;return this._x=Scale({data:this._data,range:[0,this._width()],attr:opts.xAttr,min:opts.xAxisMin,max:opts.xAxisMax,forceBounds:opts.forceAxisBounds}),this._y=Scale({data:this._data,range:[this._height(),0],attr:opts.yAttr,min:opts.yAxisMin,max:opts.yAxisMax,forceBounds:opts.forceAxisBounds}),{x:this._x,y:this._y}},_updateAxis:function _updateAxis(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._grid.call(this._appendXGrid()).call(this._appendYGrid()),this._axis.call(this._appendXaxis()).call(this._appendYaxis())},_updateArea:function _updateArea(){var opts=this.options;this._path.call(Area({interpolation:opts.interpolation,data:this._data,name:"Altitude",xAttr:opts.xAttr,yAttr:opts.yAttr,width:this._width(),height:this._height(),scaleX:this._x,scaleY:this._y}))},_appendGrid:function _appendGrid(){var _this2=this;return function(g){return g.append("g").attr("class","grid").call(_this2._appendXGrid()).call(_this2._appendYGrid())}},_appendXGrid:function _appendXGrid(){return Grid({axis:"x",position:"bottom",width:this._width(),height:this._height(),scale:this._x,ticks:this._xTicks,tickFormat:""})},_appendYGrid:function _appendYGrid(){return Grid({axis:"y",position:"left",width:this._width(),height:this._height(),scale:this._y,ticks:this.options.yTicks,tickFormat:""})},_appendAxis:function _appendAxis(){var _this3=this;return function(g){return g.append("g").attr("class","axis").call(_this3._appendXaxis()).call(_this3._appendYaxis())}},_appendXaxis:function _appendXaxis(){return Axis({axis:"x",position:"bottom",width:this._width(),height:this._height(),scale:this._x,ticks:this._xTicks,label:this._xLabel,labelY:25,labelX:this._width()+6})},_appendYaxis:function _appendYaxis(){return Axis({axis:"y",position:"left",width:this._width(),height:this._height(),scale:this._y,ticks:this.options.yTicks,label:this._yLabel,labelX:-3,labelY:-8})},_appendArea:function _appendArea(){return function(g){return g.append("g").attr("class","area").append("path")}},_appendFocusable:function _appendFocusable(){var _this4=this;return function(g){return g.append("g").attr("class","focus").call(_this4._appendFocusRect()).call(_this4._appendRuler()).call(_this4._appendMouseFocusG())}},_appendFocusRect:function _appendFocusRect(){var _this5=this;return function(g){var focusRect=g.append("rect").call(FocusRect({width:_this5._width(),height:_this5._height()}));return L.Browser.mobile&&(focusRect.on("touchstart.drag",_this5._dragStartHandler.bind(_this5)).on("touchmove.drag",_this5._dragHandler.bind(_this5)).on("touchstart.focus",_this5._mousemoveHandler.bind(_this5)).on("touchmove.focus",_this5._mousemoveHandler.bind(_this5)),L.DomEvent.on(_this5._container.node(),"touchend",_this5._dragEndHandler,_this5)),focusRect.on("mousedown.drag",_this5._dragStartHandler.bind(_this5)).on("mousemove.drag",_this5._dragHandler.bind(_this5)).on("mouseenter.focus",_this5._mouseenterHandler.bind(_this5)).on("mousemove.focus",_this5._mousemoveHandler.bind(_this5)).on("mouseout.focus",_this5._mouseoutHandler.bind(_this5)),L.DomEvent.on(_this5._container.node(),"mouseup",_this5._dragEndHandler,_this5),focusRect}},_appendMouseFocusG:function _appendMouseFocusG(){var _this6=this;return function(g){var focusG=_this6._focusG=g.append("g").attr("class","mouse-focus-group leaflet-hidden");return _this6._focusline=focusG.append("svg:line").call(MouseFocusLine({xCoord:0,height:_this6._height()})),_this6._focuslabel=focusG.append("g").call(MouseFocusLabel({xCoord:0,yCoord:0,height:_this6._height(),width:_this6._width(),labelX:"",labelY:""})),focusG}},_appendLegend:function _appendLegend(){return function(g){var legend;return g.append("g").attr("class","legend")}},_appendClipper:function _appendClipper(){var _this7=this,svg=this._container,area=svg.select(".area"),margin=this.options.margins,clip;(this._clipPath=area.insert("clipPath",":first-child").attr("id","elevation-clipper")).append("rect").attr("x",0).attr("y",0).attr("width",this._width()).attr("height",this._height());var zoom=d3.zoom().scaleExtent([1,10]).extent([[margin.left,0],[this._width()-margin.right,this._height()]]).translateExtent([[margin.left,-1/0],[this._width()-margin.right,1/0]]).filter((function(){return d3.event.ctrlKey}));return svg.call(zoom).on("wheel",(function(){})),function(g){return g}},_appendRuler:function _appendRuler(){var _this8=this,dragstart=function dragstart(d){this._hideDiagramIndicator(),this._container.select(".horizontal-drag-label").classed("leaflet-hidden",!1)},dragend=function dragend(d){var y=this._container.select(".horizontal-drag-group").node().transform.baseVal.consolidate().matrix.f;this._container.select(".horizontal-drag-label").classed("leaflet-hidden",y>=this._height()||y<=0)},dragged=function dragged(d){var yMax=this._height(),yCoord=d3.mouse(this._container.node())[1],y=yCoord>0?yCoord<yMax?yCoord:yMax:0,z=this._y.invert(y),formatNum=d3.format(".0f");this._container.select(".horizontal-drag-group").attr("transform",(function(d){return"translate("+d.x+","+y+")"})).classed("active",y<yMax),this._container.select(".horizontal-drag-label").text(formatNum(z)+" "+this._yLabel),this.fire("ruler_filter",{coords:yCoord<yMax&&yCoord>0?this._findCoordsForY(yCoord):[]})};return function(g){return _this8.options.ruler?(_this8._dragG=g.append("g").attr("class","horizontal-drag-group").call(Ruler({height:_this8._height(),width:_this8._width()})).call(d3.drag().on("start",dragstart.bind(_this8)).on("drag",dragged.bind(_this8)).on("end",dragend.bind(_this8))),g):g}},_width:function _width(){var opts=this.options;return opts.width-opts.margins.left-opts.margins.right},_height:function _height(){var opts=this.options;return opts.height-opts.margins.top-opts.margins.bottom},_dragHandler:function _dragHandler(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragStartHandler:function _dragStartHandler(){d3.event.ctrlKey||(d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node()))},_drawDragRectangle:function _drawDragRectangle(){this._dragStartCoords&&this._draggingEnabled&&(this._dragRectangle||(this._dragRectangle=this._focus.insert("rect",".mouse-focus-group").attr("class","mouse-drag").style("pointer-events","none")),this._dragRectangle.call(DragRectangle({dragStartCoords:this._dragStartCoords,dragEndCoords:this._dragCurrentCoords=d3.mouse(this._focusRect.node()),height:this._height()})))},_dragEndHandler:function _dragEndHandler(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void(this._draggingEnabled&&this._resetDrag());var start=this._findIndexForXCoord(this._dragStartCoords[0]),end=this._findIndexForXCoord(this._dragCurrentCoords[0]);start!=end&&(this._dragStartCoords=null,this._gotDragged=!1,this.fire("dragged",{dragstart:this._data[start],dragend:this._data[end]}))},_mouseenterHandler:function _mouseenterHandler(){this.fire("mouse_enter")},_mousemoveHandler:function _mousemoveHandler(d,i,ctx){var coords,xCoord=d3.mouse(this._focusRect.node())[0],item=this._data[this._findIndexForXCoord(xCoord)];this.fire("mouse_move",{item:item,xCoord:xCoord})},_mouseoutHandler:function _mouseoutHandler(){this.fire("mouse_out")},_findCoordsForY:function _findCoordsForY(y){var data=this._data,z=this._y.invert(y),list=data.reduce((function(array,item,index){return item.z>=z&&array.push(index),array}),[]),start=0,next,coords;return list.reduce((function(array,_,curr){return list[next=curr+1]===list[curr]+1&&next!==list.length||(array.push(list.slice(start,next).map((function(i){return data[i].latlng}))),start=next),array}),[])},_findIndexForXCoord:function _findIndexForXCoord(x){var _this9=this;return d3.bisector((function(d){return d[_this9.options.xAttr]})).left(this._data||[0,1],this._x.invert(x))},_findIndexForLatLng:function _findIndexForLatLng(latlng){var result=null,d=1/0;return this._data.forEach((function(item,index){var dist=latlng.distanceTo(item.latlng);dist<d&&(d=dist,result=index)})),result},_resetDrag:function _resetDrag(){this._dragRectangle&&(this._dragRectangle.remove(),this._dragRectangle=null,this._hideDiagramIndicator(),this.fire("reset_drag"))},_showDiagramIndicator:function _showDiagramIndicator(item,xCoordinate){var opts=this.options,yCoordinate=this._y(item[opts.yAttr]);this._focusG.classed("leaflet-hidden",!1),this._focusline.call(MouseFocusLine({xCoord:xCoordinate,height:this._height()})),this._focuslabel.call(MouseFocusLabel({xCoord:xCoordinate,yCoord:yCoordinate,height:this._height(),width:this._width(),labelX:formatNum(item[opts.xAttr],opts.decimalsX)+" "+this._xLabel,labelY:formatNum(item[opts.yAttr],opts.decimalsY)+" "+this._yLabel}))},_hideDiagramIndicator:function _hideDiagramIndicator(){this._focusG.classed("leaflet-hidden",!0)}}),Marker=L.Class.extend({initialize:function initialize(options){return this.options=options,this.options.imperial?(this._xLabel="mi",this._yLabel="ft"):(this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),"elevation-line"==this.options.marker?(this._focusline=d3.create("svg:line"),this._focusmarker=d3.create("svg:circle"),this._focuslabel=d3.create("svg:text")):"position-marker"==this.options.marker&&(this._marker=L.marker([0,0],{icon:this.options.markerIcon,zIndexOffset:1e6,interactive:!1})),this},addTo:function addTo(map){var _this=this;if(this._map=map,"elevation-line"==this.options.marker){var g=this._container=d3.select(map.getPane("elevationPane")).select("svg > g").attr("class","height-focus-group");g.append((function(){return _this._focusline.node()})),g.append((function(){return _this._focusmarker.node()})),g.append((function(){return _this._focuslabel.node()}))}else"position-marker"==this.options.marker&&this._marker.addTo(map,{pane:"elevationPane"});return this},update:function update(props){props.options&&(this.options=props.options),this._map||this.addTo(props.map);var opts=this.options;this._latlng=props.item.latlng;var point=L.extend({},props.item,this._map.latLngToLayerPoint(this._latlng));if("elevation-line"==this.options.marker){var normalizedAlt=this._height()/props.maxElevation*point.z,normalizedY=point.y-normalizedAlt;this._container.classed("leaflet-hidden",!1),this._focusmarker.call(HeightFocusMarker({theme:opts.theme,xCoord:point.x,yCoord:point.y})),this._focusline.call(HeightFocusLine({theme:opts.theme,xCoord:point.x,yCoord:point.y,length:normalizedY})),this._focuslabel.call(HeightFocusLabel({theme:opts.theme,xCoord:point.x,yCoord:normalizedY,label:formatNum(point[opts.yAttr],opts.decimalsY)+" "+this._yLabel}))}else"position-marker"==this.options.marker&&(removeClass(this._marker.getElement(),"leaflet-hidden"),this._marker.setLatLng(this._latlng))},remove:function remove(){"elevation-line"==this.options.marker?this._container&&this._container.classed("leaflet-hidden",!0):"position-marker"==this.options.marker&&addClass(this._marker.getElement(),"leaflet-hidden")},getLatLng:function getLatLng(){return this._latlng},_height:function _height(){var opts=this.options;return opts.height-opts.margins.top-opts.margins.bottom}}),Summary=L.Class.extend({initialize:function initialize(opts){var summary;this.options=opts,style(this._container=create("div","elevation-summary "+(opts.summary?opts.summary+"-summary":"")),"max-width",opts.width?opts.width+"px":"")},render:function render(){var _this=this;return function(container){return container.append((function(){return _this._container}))}},reset:function reset(){this._container.innerHTML=""},append:function append(className,label,value){return this._container.innerHTML+='<span class="'.concat(className,'"><span class="summarylabel">').concat(label,'</span><span class="summaryvalue">').concat(value,"</span></span>"),this}}),Options={autofitBounds:!0,autohide:!L.Browser.mobile,autohideMarker:!0,collapsed:!1,detached:!0,distanceFactor:1,decimalsX:2,decimalsY:0,dragging:!L.Browser.mobile,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},margins:{top:30,right:30,bottom:30,left:40},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},polylineSegments:{className:"elevation-polyline-segments",color:"#F00",interactive:!1},reverseCoords:!1,ruler:!0,skipNullZCoords:!1,theme:"lightblue-theme",responsive:!0,summary:"inline",slope:!1,speed:!1,sLimit:void 0,time:!1,timeFactor:3600,timeFormat:!1,sDeltaMax:void 0,sInterpolation:"curveStepAfter",sRange:void 0,width:600,xAttr:"dist",xLabel:"km",xTicks:void 0,yAttr:"z",yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:!1},Elevation=L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:Options,__mileFactor:.621371,__footFactor:3.28084,__D3:"https://unpkg.com/d3@5.15.0/dist/d3.min.js",__LGPX:"https://unpkg.com/leaflet-gpx@1.5.0/gpx.js",addData:function addData(d,layer){var _this=this;null==layer&&d.on&&(layer=d),Elevation._d3LazyLoader=lazyLoader(this.__D3,"object"!==("undefined"==typeof d3?"undefined":_typeof(d3))||!this.options.lazyLoadJS,Elevation._d3LazyLoader).then((function(){_this._addData(d),_this._addLayer(layer),_this._fireEvt("eledata_added",{data:d,layer:layer,track_info:_this.track_info})}))},addTo:function addTo(map){if(this.options.detached){var eleDiv=this._initElevationDiv();eleDiv.isConnected||insert(map.getContainer(),eleDiv,"afterend"),append(eleDiv,this.onAdd(map))}else L.Control.prototype.addTo.call(this,map);return this},clear:function clear(){this._marker&&this._marker.remove(),this._chart&&this._chart.clear(),this._layers&&this._layers.clearLayers(),this._data=[],this.track_info={},this._fireEvt("eledata_clear")},disableDragging:function disableDragging(){this._chart._draggingEnabled=!1,this._resetDrag()},enableDragging:function enableDragging(){this._chart._draggingEnabled=!0},fitBounds:function fitBounds(bounds){bounds=bounds||this.getBounds(),this._map&&bounds.isValid()&&this._map.fitBounds(bounds)},getBounds:function getBounds(data){return data=data||this._data,L.latLngBounds(data.map((function(d){return d.latlng})))},getZFollow:function getZFollow(){return this._zFollow},hide:function hide(){style(this._container,"display","none")},initialize:function initialize(options){this._data=[],this._layers=L.featureGroup(),this._markedSegments=L.polyline([]),this._chartEnabled=!0,this.track_info={},this.options=deepMerge({},this.options,options),this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.options.legend&&(this.options.margins.bottom+=30),this.options.theme&&(this.options.polylineSegments.className+=" "+this.options.theme),this._markedSegments.setStyle(this.options.polylineSegments)},load:function load(data,opts){this.loadData(data,opts)},loadChart:function loadChart(map){this.addTo(map)},loadData:function loadData(data,opts){(opts=L.extend({},this.options.loadData,opts)).defer?this.loadDefer(data,opts):opts.lazy?this.loadLazy(data,opts):isXMLDoc(data)?this.loadGPX(data):isJSONDoc(data)?this.loadGeoJSON(data):this.loadFile(data)},loadDefer:function loadDefer(data,opts){(opts=L.extend({},this.options.loadData,opts)).defer=!1,deferFunc(L.bind(this.loadData,this,data,opts))},loadFile:function loadFile$1(url){var _this2=this;loadFile(url).then((function(data){_this2._downloadURL=url,_this2.loadData(data,{lazy:!1,defer:!1})})).catch((function(err){return console.warn(err)}))},loadGeoJSON:function loadGeoJSON(data){GeoJSONLoader(data,this)},loadGPX:function loadGPX(data){var _this3=this;Elevation._gpxLazyLoader=lazyLoader(this.__LGPX,"function"!=typeof L.GPX||!this.options.lazyLoadJS,Elevation._gpxLazyLoader).then((function(){return GPXLoader(data,_this3)}))},loadLazy:function loadLazy(data,opts){var _this4=this,elem=(opts=L.extend({},this.options.loadData,opts)).lazy.parentNode?opts.lazy:this.placeholder;waitHolder(elem).then((function(){opts.lazy=!1,_this4.loadData(data,opts),_this4.once("eledata_loaded",(function(){return _this4.placeholder.parentNode.removeChild(elem)}))}))},onAdd:function onAdd(map){var _this5=this;this._map=map;var container=this._container=create("div","elevation-control elevation "+this.options.theme);return this.options.detached||addClass(container,"leaflet-control"),this.options.placeholder&&!this._data.length&&(this.placeholder=create("img","elevation-placeholder","string"==typeof this.options.placeholder?{src:this.options.placeholder,alt:""}:this.options.placeholder),insert(container,this.placeholder,"afterbegin")),Elevation._d3LazyLoader=lazyLoader(this.__D3,"object"!==("undefined"==typeof d3?"undefined":_typeof(d3))||!this.options.lazyLoadJS,Elevation._d3LazyLoader).then((function(){_this5._initButton(container),_this5._initChart(container),_this5._initSummary(container),_this5._initMarker(map),_this5._initLayer(map),map.on("zoom viewreset zoomanim",_this5._hideMarker,_this5).on("resize",_this5._resetView,_this5).on("resize",_this5._resizeChart,_this5).on("mousedown",_this5._resetDrag,_this5),on(map.getContainer(),"mousewheel",_this5._resetDrag,_this5),on(map.getContainer(),"touchstart",_this5._resetDrag,_this5),_this5.on("eledata_added eledata_loaded",_this5._updateChart,_this5).on("eledata_added eledata_loaded",_this5._updateSummary,_this5),_this5._updateChart(),_this5._updateSummary()})),container},onRemove:function onRemove(map){this._container=null,map.off("zoom viewreset zoomanim",this._hideMarker,this).off("resize",this._resetView,this).off("resize",this._resizeChart,this).off("mousedown",this._resetDrag,this),off(map.getContainer(),"mousewheel",this._resetDrag,this),off(map.getContainer(),"touchstart",this._resetDrag,this),this.off("eledata_added eledata_loaded",this._updateChart,this).off("eledata_added eledata_loaded",this._updateSummary,this)},redraw:function redraw(){this._resizeChart()},setZFollow:function setZFollow(zoom){this._zFollow=zoom},show:function show(){style(this._container,"display","block")},_addData:function _addData(d){var _this6=this,geom=d&&d.geometry,feat=d&&"FeatureCollection"===d.type,gpx=d&&d._latlngs;if(geom)switch(geom.type){case"LineString":this._addGeoJSONData(geom.coordinates);break;case"MultiLineString":each(geom.coordinates,(function(coords){return _this6._addGeoJSONData(coords)}));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+geom.type)}feat&&each(d.features,(function(feature){return _this6._addData(feature)})),gpx&&this._addGPXData(d._latlngs)},_addGeoJSONData:function _addGeoJSONData(coords){var _this7=this;each(coords,(function(point){_this7._addPoint(point[1],point[0],point[2]),_this7._fireEvt("elepoint_added",{point:point,index:_this7._data.length-1})})),this._fireEvt("eletrack_added",{coords:coords,index:this._data.length-1})},_addGPXData:function _addGPXData(coords){var _this8=this;each(coords,(function(point){_this8._addPoint(point.lat,point.lng,point.meta.ele),_this8._fireEvt("elepoint_added",{point:point,index:_this8._data.length-1})})),this._fireEvt("eletrack_added",{coords:coords,index:this._data.length-1})},_addPoint:function _addPoint(x,y,z){if(this.options.reverseCoords){var _ref=[y,x];x=_ref[0],y=_ref[1]}this._data.push({x:x,y:y,z:z,latlng:L.latLng(x,y,z)}),this._fireEvt("eledata_updated",{index:this._data.length-1})},_addLayer:function _addLayer(layer){layer&&this._layers.addLayer(layer)},_initElevationDiv:function _initElevationDiv(){var eleDiv=select(this.options.elevationDiv);return eleDiv||(this.options.elevationDiv="#elevation-div_"+randomId(),eleDiv=create("div","leaflet-control elevation elevation-div",{id:this.options.elevationDiv.substr(1)})),this.options.detached&&(addClass(eleDiv,"elevation-detached"),removeClass(eleDiv,"leaflet-control")),this.eleDiv=eleDiv,this.eleDiv},_collapse:function _collapse(){removeClass(this._container,"elevation-expanded"),addClass(this._container,"elevation-collapsed")},_expand:function _expand(){removeClass(this._container,"elevation-collapsed"),addClass(this._container,"elevation-expanded")},_findItemForLatLng:function _findItemForLatLng(latlng){return this._data[this._chart._findIndexForLatLng(latlng)]},_findItemForX:function _findItemForX(x){return this._data[this._chart._findIndexForXCoord(x)]},_fireEvt:function _fireEvt(type,data,propagate){this.fire&&this.fire(type,data,propagate),this._map&&this._map.fire(type,data,propagate)},_height:function _height(){var opts=this.options;return opts.height-opts.margins.top-opts.margins.bottom},_hideMarker:function _hideMarker(){this.options.autohideMarker&&this._marker.remove()},_initChart:function _initChart(container){var opts=this.options;if(opts.xTicks=opts.xTicks||Math.round(this._width()/75),opts.yTicks=opts.yTicks||Math.round(this._height()/30),opts.responsive)if(opts.detached){var offWi=this.eleDiv.offsetWidth,offHe=this.eleDiv.offsetHeight;opts.width=offWi>0?offWi:opts.width,opts.height=offHe-20>0?offHe-20:opts.height}else{opts._maxWidth=opts._maxWidth>opts.width?opts._maxWidth:opts.width;var containerWidth=this._map.getContainer().clientWidth;opts.width=opts._maxWidth>containerWidth?containerWidth-30:opts.width}var chart=this._chart=new Chart(opts);d3.select(container).call(chart.render()),chart.on("reset_drag",this._hideMarker,this).on("mouse_enter",this._fireEvt.bind("elechart_enter"),this).on("dragged",this._dragendHandler,this).on("mouse_move",this._mousemoveHandler,this).on("mouse_out",this._mouseoutHandler,this).on("ruler_filter",this._rulerFilterHandler,this).on("zoom",this._updateChart,this),this._fireEvt("elechart_axis"),this.options.legend&&this._fireEvt("elechart_legend"),this._fireEvt("elechart_init")},_initLayer:function _initLayer(){var _this9=this;this._layers.on("layeradd layerremove",(function(e){var layer=e.layer,toggleClass="layeradd"==e.type?addClass:removeClass,toggleEvt=layer["layeradd"==e.type?"on":"off"].bind(layer);toggleClass(layer.getElement&&layer.getElement(),_this9.options.polyline.className+" "+_this9.options.theme),toggleEvt("mousemove",_this9._mousemoveLayerHandler,_this9),toggleEvt("mouseout",_this9._mouseoutHandler,_this9)}))},_initMarker:function _initMarker(map){var pane=map.getPane("elevationPane");pane||((pane=this._pane=map.createPane("elevationPane")).style.zIndex=625,pane.style.pointerEvents="none"),this._renderer&&this._renderer.remove(),this._renderer=L.svg({pane:"elevationPane"}).addTo(this._map),this._marker=new Marker(this.options)},_initButton:function _initButton(container){if(container.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(container),L.Browser.mobile&&on(container,"click",L.DomEvent.stopPropagation),on(container,"mousewheel",this._mousewheelHandler,this),!this.options.detached){var link=this._button=create("a","elevation-toggle elevation-toggle-icon"+(this.options.autohide?"":" close-button"),{href:"#",title:L._("Elevation")},container);this.options.collapsed&&(this._collapse(),this.options.autohide?(on(container,"mouseover",this._expand,this),on(container,"mouseout",this._collapse,this)):(on(link,"click",L.DomEvent.stop),on(link,"click",this._toggle,this)),on(link,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_initSummary:function _initSummary(container){var summary=this._summary=new Summary({summary:this.options.summary});d3.select(container).call(summary.render()),this.summaryDiv=this._summary._container},_dragendHandler:function _dragendHandler(e){this._hideMarker(),this.fitBounds(L.latLngBounds([e.dragstart.latlng,e.dragend.latlng])),this._fireEvt("elechart_dragged")},_mousemoveHandler:function _mousemoveHandler(e){if(this._data.length&&this._chartEnabled){var item=this._findItemForX(e.xCoord);if(item){var xCoord=e.xCoord;this._chartEnabled&&this._chart._showDiagramIndicator(item,xCoord),this._updateMarker(item),this._setMapView(item),this._map&&addClass(this._map.getContainer(),"elechart-hover"),this._fireEvt("elechart_change",{data:item,xCoord:xCoord}),this._fireEvt("elechart_hover",{data:item,xCoord:xCoord})}}},_mousemoveLayerHandler:function _mousemoveLayerHandler(e){if(this._data.length){var item=this._findItemForLatLng(e.latlng);if(item){var xCoord=item.xDiagCoord;this._chartEnabled&&this._chart._showDiagramIndicator(item,xCoord),this._updateMarker(item),this._fireEvt("elechart_change",{data:item,xCoord:xCoord})}}},_mouseoutHandler:function _mouseoutHandler(){this.options.detached||(this._hideMarker(),this._chart._hideDiagramIndicator()),this._map&&removeClass(this._map.getContainer(),"elechart-hover"),this._fireEvt("elechart_leave")},_mousewheelHandler:function _mousewheelHandler(e){if(!this._map.gestureHandling||!this._map.gestureHandling._enabled){var ll=this._marker.getLatLng()||this._map.getCenter(),z=this._map.getZoom()+Math.sign(e.deltaY);this._resetDrag(),this._map.flyTo(ll,z)}},_resetDrag:function _resetDrag(){this._chart._resetDrag(),this._hideMarker()},_resetView:function _resetView(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hideMarker(),this.options.autofitBounds&&this.fitBounds())},_resizeChart:function _resizeChart(){if("none"!=style(this._container,"display")){if(this.options.responsive)if(this.options.detached){var newWidth=this.eleDiv.offsetWidth;newWidth&&(this.options.width=newWidth,this.eleDiv.innerHTML="",append(this.eleDiv,this.onAdd(this._map)))}else this._map.removeControl(this._container),this.addTo(this._map);this._updateMapSegments()}},_rulerFilterHandler:function _rulerFilterHandler(e){this._updateMapSegments(e.coords)},_toggle:function _toggle(){hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function _setMapView(item){if(this.options.followMarker&&this._map){var zoom=this._map.getZoom();"number"==typeof this._zFollow?(zoom=zoom<this._zFollow?this._zFollow:zoom,this._map.setView(item.latlng,zoom,{animate:!0,duration:.25})):this._map.getBounds().contains(item.latlng)||this._map.setView(item.latlng,zoom,{animate:!0,duration:.25})}},_updateChart:function _updateChart(){this._data.length&&this._container&&(this._chart=this._chart.update({data:this._data}),this._x=this._chart._x,this._y=this._chart._y,this._fireEvt("elechart_axis"),this._fireEvt("elechart_area"),this._fireEvt("elechart_updated"))},_updateMarker:function _updateMarker(item){this._marker.update({map:this._map,item:item,maxElevation:this._maxElevation,options:this.options})},_updateMapSegments:function _updateMapSegments(coords){this._markedSegments.setLatLngs(coords||[]),coords&&this._map&&!this._map.hasLayer(this._markedSegments)&&this._markedSegments.addTo(this._map)},_updateSummary:function _updateSummary(){var _this10=this;this._summary.reset(),this.options.summary&&this._fireEvt("elechart_summary"),this.options.downloadLink&&this._downloadURL&&(this.summaryDiv.innerHTML+='<span class="download"><a href="#">'+L._("Download")+"</a></span>",select(".download a",this.summaryDiv).onclick=function(e){e.preventDefault(),_this10._fireEvt("eletrack_download",{downloadLink:_this10.options.downloadLink,confirm:saveFile.bind(_this10,_this10._downloadURL)})})},_width:function _width(){var opts=this.options;return opts.width-opts.margins.left-opts.margins.right}});Elevation.addInitHook((function(){this.on("waypoint_added",(function(e){var p=e.point,pop=p._popup;pop&&(pop.options.className="elevation-popup"),pop&&pop._content&&(pop._content=decodeURI(pop._content),p.bindTooltip(pop._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip())})),this.on("elepath_toggle",(function(e){var _this11=this,path=e.path,optName=path.getAttribute("data-name").toLowerCase(),enable=hasClass(path,"leaflet-hidden"),label=select("text",e.legend),rect=select("rect",e.legend);style(label,"text-decoration-line",enable?"":"line-through"),style(rect,"fill-opacity",enable?"":"0"),toggleClass(path,"leaflet-hidden",!enable),this._chartEnabled=0!=this._chart._area.selectAll("path:not(.leaflet-hidden)").nodes().length,this._layers.eachLayer((function(l){return toggleClass(l.getElement&&l.getElement(),_this11.options.polyline.className+" "+_this11.options.theme,_this11._chartEnabled)})),this.options[optName]=enable&&"disabled"==this.options[optName]?"enabled":"disabled",this._chartEnabled||(this._chart._hideDiagramIndicator(),this._marker.remove())})),this.on("elechart_updated elechart_init",(function(){var _this12=this,items=this._chart._legend.selectAll(".legend-item"),n=items.nodes().length,v=Array(Math.floor(n/2)).fill(null).map((function(d,i){return 2*(i+1)-(1-Math.sign(n%2))})),rev=v.slice().reverse().map((function(d){return-d}));n%2!=0&&rev.push(0),v=rev.concat(v);var xAxesB=this._chart._axis.selectAll(".x.axis.bottom").nodes().length,marginR=30*n;n&&this.options.margins.right!=marginR&&(this.options.margins.right=marginR,this.redraw());var marginB=60+2*xAxesB;xAxesB&&this.options.margins.bottom!=marginB&&(this.options.margins.bottom=marginB,this.redraw()),items.each((function(d,i,n){var target=n[i],name=target.getAttribute("data-name"),optName=name.toLowerCase(),path=_this12._chart._area.select('path[data-name="'+name+'"]').node();d3.select(target).on("click",(function(){return _this12._fireEvt("elepath_toggle",{path:path,name:name,legend:target})})),path&&optName in _this12.options&&"disabled"==_this12.options[optName]&&(path.classList.add("leaflet-hidden"),target.querySelector("text").style.textDecorationLine="line-through",target.querySelector("rect").style.fillOpacity="0"),path&&_this12._chart._clipPath&&path.setAttribute("clip-path","url(#"+_this12._chart._clipPath.attr("id")+")"),d3.select(target).attr("transform","translate("+55*v[i]+", "+2*xAxesB+")")})),this._chart._axis.selectAll(".y.axis.right").each((function(d,i,n){var axis=d3.select(n[i]),transform=axis.attr("transform"),translate=transform.substring(transform.indexOf("(")+1,transform.indexOf(")")).split(",");axis.attr("transform","translate("+(+translate[0]+40*i)+","+translate[1]+")"),i>0&&(axis.select(":scope > path").attr("opacity",.25),axis.selectAll(":scope > .tick line").attr("opacity",.75))}))})),this.on("eletrack_download",(function(e){"modal"==e.downloadLink&&"function"==typeof CustomEvent?document.dispatchEvent(new CustomEvent("eletrack_download",{detail:e})):"link"!=e.downloadLink&&!0!==e.downloadLink||e.confirm()})),this.on("eledata_loaded",(function(e){var _this13=this,map=this._map,layer=e.layer;map?(map.once("layeradd",(function(e){this.options.autofitBounds&&this.fitBounds(layer.getBounds())}),this),this.options.polyline&&layer.addTo(map),L.GeometryUtil&&map.almostOver&&map.almostOver.enabled()&&!L.Browser.mobile&&(map.almostOver.addLayer(layer),map.on("almost:move",(function(e){return _this13._mousemoveLayerHandler(e)})).on("almost:out",(function(e){return _this13._mouseoutHandler(e)})))):console.warn("Undefined elevation map object")}));var oldProto=L.Canvas.prototype._fillStroke,control=this;L.Canvas.include({_fillStroke:function _fillStroke(ctx,layer){if(control._layers.hasLayer(layer)){var theme=control.options.theme.replace("-theme",""),options=layer.options;switch(options.stroke=!0,theme){case"lightblue":options.color="#3366CC";break;case"magenta":options.color="#FF005E";break;case"red":options.color="#F00";break;case"yellow":options.color="#FF0";break;case"purple":options.color="#732C7B";break;case"steelblue":options.color="#4682B4";break;case"lime":options.color="#566B13";break;default:theme?options.color=theme:options.stroke=!1}if(oldProto.call(this,ctx,layer),options.stroke&&0!==options.weight){var oldVal=ctx.globalCompositeOperation||"source-over";ctx.globalCompositeOperation="destination-over",ctx.strokeStyle="#FFF",ctx.lineWidth=1.75*options.weight,ctx.stroke(),ctx.globalCompositeOperation=oldVal}}else oldProto.call(this,ctx,layer)}}),this.on("elechart_init",(function(){this.once("elechart_change elechart_hover",(function(e){this._chartEnabled&&this._chart._showDiagramIndicator(e.data,e.xCoord),this._updateMarker(e.data)}))}))})),Elevation.addInitHook((function(){this.options.imperial?(this._distanceFactor=this.__mileFactor,this._xLabel="mi"):(this._distanceFactor=this.options.distanceFactor,this._xLabel=this.options.xLabel),this.on("eledata_updated",(function(e){var data=this._data,i=e.index,dist=this._distance||0,curr=data[i].latlng,prev=i>0?data[i-1].latlng:curr,delta=curr.distanceTo(prev)*this._distanceFactor;dist+=Math.round(delta/1e3*1e5)/1e5,data[i].dist=dist,this.track_info.distance=this._distance=dist})),this.on("elechart_summary",(function(){this.track_info.distance=this._distance||0,this._summary.append("totlen",L._("Total Length: "),this.track_info.distance.toFixed(2)+"&nbsp;"+this._xLabel)})),this.on("eledata_clear",(function(){this._distance=0}))})),Elevation.addInitHook((function(){this.options.imperial?(this._heightFactor=this.__footFactor,this._yLabel="ft"):(this._heightFactor=this.options.heightFactor,this._yLabel=this.options.yLabel),this.on("eledata_updated",(function(e){var data=this._data,i=e.index,z=data[i].z*this._heightFactor,eleMax=this._maxElevation||-1/0,eleMin=this._minElevation||1/0;if(!this.options.skipNullZCoords&&i>0){var prevZ=data[i-1].z;if(isNaN(prevZ)){var lastZ=this._lastValidZ,currZ=z;if(isNaN(lastZ)||isNaN(currZ)?isNaN(lastZ)?isNaN(currZ)||(prevZ=currZ):prevZ=lastZ:prevZ=(lastZ+currZ)/2,!isNaN(prevZ))return data.splice(i-1,1);data[i-1].z=prevZ}}isNaN(z)||(eleMax=eleMax<z?z:eleMax,eleMin=eleMin>z?z:eleMin,this._lastValidZ=z),data[i].z=z,this.track_info.elevation_max=this._maxElevation=eleMax,this.track_info.elevation_min=this._minElevation=eleMin})),this.on("elechart_legend",(function(){this._altitudeLegend=this._chart._legend.append("g").call(LegendItem({name:"Altitude",width:this._width(),height:this._height(),margins:this.options.margins}))})),this.on("elechart_summary",(function(){this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,this._summary.append("maxele",L._("Max Elevation: "),this.track_info.elevation_max.toFixed(2)+"&nbsp;"+this._yLabel).append("minele",L._("Min Elevation: "),this.track_info.elevation_min.toFixed(2)+"&nbsp;"+this._yLabel)})),this.on("eledata_clear",(function(){this._maxElevation=null,this._minElevation=null}))})),Elevation.addInitHook((function(){this._timeFactor=this.options.timeFactor;var time={};this.options.timeFormat?"time"==this.options.timeFormat?this.options.timeFormat=function(time){return new Date(time).toLocaleTimeString()}:"date"==this.options.timeFormat&&(this.options.timeFormat=function(time){return new Date(time).toLocaleDateString()}):this.options.timeFormat=function(time){return new Date(time).toLocaleString().replaceAll("/","-").replaceAll(","," ")},this.options.time&&"summary"!=this.options.time&&!L.Browser.mobile&&this.on("elechart_axis",(function(){var _this=this;this.options.xTimeFormat||(this.options.xTimeFormat=d3.utcFormat("%H:%M")),time.y=this._chart._y,time.x=Scale({data:this._data,range:[0,this._width()],attr:"duration",min:0}),time.axis=Axis({axis:"x",position:"top",width:this._width(),height:0,scale:time.x,ticks:1.5*this.options.xTicks,label:"t",labelY:-10,labelX:this._width(),name:"time",tickFormat:function tickFormat(d){var t=_this.options.xTimeFormat(d);return"00:00"==t?"":t}}),this._chart._axis.call(time.axis).call((function(g){var axis=g.select(".x.axis.time");axis.select(".domain").remove(),axis.selectAll("text").attr("opacity",.65).style("font-family","Monospace").style("font-size","110%"),axis.selectAll(".tick line").attr("y2",_this._height()).attr("stroke-dasharray",2).attr("opacity",.75)}))})),this.on("elepoint_added",(function(e){if(e.point.meta&&e.point.meta.time){var data=this._data,i=e.index,time=e.point.meta.time;time.getTime()-6e4*time.getTimezoneOffset()==0&&(time=0),data[i].time=time;var currT=data[i].time,prevT=i>0?data[i-1].time:currT,deltaT=Math.abs(currT-prevT),duration=(this.track_info.time||0)+deltaT;data[i].duration=duration,this.track_info.time=duration}})),this.options.time&&(this.on("elechart_change",(function(e){var chart=this._chart,item=e.data;chart._focuslabel&&item.time&&(chart._focuslabelTime&&chart._focuslabelTime.property("isConnected")||(chart._focuslabelTime=chart._focuslabel.select("text").insert("svg:tspan",".mouse-focus-label-x").attr("class","mouse-focus-label-time").attr("dy","1.5em")),chart._focuslabelTime.text(this.options.timeFormat(item.time)))})),this.on("elechart_summary",(function(){this.track_info.time=this.track_info.time||0,this._summary.append("tottime",L._("Total Time: "),formatTime(this.track_info.time))})))})),Elevation.addInitHook((function(){if(this.options.slope){var opts=this.options,slope={};"summary"!=this.options.slope&&(this.on("elechart_init",(function(){slope.path=this._chart._area.append("path").style("pointer-events","none").attr("fill","#F00").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")})),this.on("elechart_axis",(function(){slope.x=this._chart._x,slope.y=Scale({data:this._data,range:[this._height(),0],attr:"slope",min:-1,max:1,forceBounds:opts.forceAxisBounds}),slope.axis=Axis({axis:"y",position:"right",width:this._width(),height:this._height(),scale:slope.y,ticks:this.options.yTicks,tickPadding:16,label:"%",labelX:25,labelY:-8,name:"slope"}),this._chart._axis.call(slope.axis)})),this.on("elechart_area",(function(){slope.area=Area({interpolation:opts.sInterpolation,data:this._data,name:"Slope",xAttr:opts.xAttr,yAttr:"slope",width:this._width(),height:this._height(),scaleX:slope.x,scaleY:slope.y}),slope.path.call(slope.area)})),this.on("elechart_legend",(function(){slope.legend=this._chart._legend.append("g").call(LegendItem({name:"Slope",width:this._width(),height:this._height(),margins:this.options.margins})),slope.legend.select("rect").classed("area",!1).attr("fill","#F00").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")}))),this.on("eledata_updated",(function(e){var data=this._data,i=e.index,z=data[i].z,curr=data[i].latlng,prev=i>0?data[i-1].latlng:curr,delta=curr.distanceTo(prev)*this._distanceFactor,tAsc=this._tAsc||0,tDes=this._tDes||0,sMax=this._sMax||0,sMin=this._sMin||0,slope=0;if(!isNaN(z)){var deltaZ=i>0?z-data[i-1].z:0;deltaZ>0?tAsc+=deltaZ:deltaZ<0&&(tDes-=deltaZ),slope=0!==delta?deltaZ/delta*100:0}if(this.options.sDeltaMax){var deltaS=i>0?slope-data[i-1].slope:0,maxDeltaS=this.options.sDeltaMax;Math.abs(deltaS)>maxDeltaS&&(slope=data[i-1].slope+maxDeltaS*Math.sign(deltaS))}if(this.options.sRange){var range=this.options.sRange;slope<range[0]?slope=range[0]:slope>range[1]&&(slope=range[1])}sMax=(slope=L.Util.formatNum(slope,2))>sMax?slope:sMax,sMin=slope<sMin?slope:sMin,data[i].slope=slope,this.track_info.ascent=this._tAsc=tAsc,this.track_info.descent=this._tDes=tDes,this.track_info.slope_max=this._sMax=sMax,this.track_info.slope_min=this._sMin=sMin})),this.on("elechart_change",(function(e){var item=e.data,xCoordinate=e.xCoord,chart=this._chart,marker=this._marker;chart._focuslabel&&(chart._focuslabelSlope&&chart._focuslabelSlope.property("isConnected")||(chart._focuslabelSlope=chart._focuslabel.select("text").insert("svg:tspan",".mouse-focus-label-x").attr("class","mouse-focus-label-slope").attr("dy","1.5em")),chart._focuslabelSlope.text(item.slope+"%"),chart._focuslabel.select(".mouse-focus-label-x").attr("dy","1.5em")),marker._focuslabel&&(chart._mouseSlopeFocusLabel||(chart._mouseSlopeFocusLabel=marker._focuslabel.append("svg:tspan").attr("class","height-focus-slope ")),chart._mouseSlopeFocusLabel.attr("dy","1.5em").text(Math.round(item.slope)+"%"),marker._focuslabel.select(".height-focus-y").attr("dy","-1.5em"))})),this.on("elechart_summary",(function(){this.track_info.ascent=this._tAsc||0,this.track_info.descent=this._tDes||0,this.track_info.slope_max=this._sMax||0,this.track_info.slope_min=this._sMin||0,this._summary.append("ascent",L._("Total Ascent: "),Math.round(this.track_info.ascent)+"&nbsp;"+this._yLabel).append("descent",L._("Total Descent: "),Math.round(this.track_info.descent)+"&nbsp;"+this._yLabel).append("minslope",L._("Min Slope: "),Math.round(this.track_info.slope_min)+"&nbsp;%").append("maxslope",L._("Max Slope: "),Math.round(this.track_info.slope_max)+"&nbsp;%")})),this.on("eledata_clear",(function(){this._sMax=null,this._sMin=null,this._tAsc=null,this._tDes=null}))}})),Elevation.addInitHook((function(){if(this.options.speed||this.options.acceleration){var opts=this.options,speed={};speed.label=opts.speedLabel||L._(this.options.imperial?"mph":"km/h"),this._speedFactor=opts.speedFactor||1,this.options.speed&&"summary"!=this.options.speed&&(this.on("elechart_init",(function(){speed.path=this._chart._area.append("path").style("pointer-events","none").attr("fill","#03ffff").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")})),this.on("elechart_axis",(function(){speed.x=this._chart._x,speed.y=Scale({data:this._data,range:[this._height(),0],attr:"speed",min:0,max:1,forceBounds:opts.forceAxisBounds}),speed.axis=Axis({axis:"y",position:"right",width:this._width(),height:this._height(),scale:speed.y,ticks:this.options.yTicks,tickPadding:16,label:speed.label,labelX:25,labelY:-8,name:"speed"}),this._chart._axis.call(speed.axis)})),this.on("elechart_area",(function(){speed.area=Area({interpolation:opts.sInterpolation,data:this._data,name:"Speed",xAttr:opts.xAttr,yAttr:"speed",width:this._width(),height:this._height(),scaleX:speed.x,scaleY:speed.y}),speed.path.call(speed.area)})),this.on("elechart_legend",(function(){speed.legend=this._chart._legend.append("g").call(LegendItem({name:"Speed",width:this._width(),height:this._height(),margins:this.options.margins})),speed.legend.select("rect").classed("area",!1).attr("fill","#03ffff").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")}))),this.on("elepoint_added",(function(e){var data=this._data,i=e.index,currT=data[i].time,prevT,deltaT=currT-(i>0?data[i-1].time:currT),sMax=this._maxSpeed||-1/0,sMin=this._minSpeed||1/0,sAvg=this._avgSpeed||0,speed=0;if(deltaT>0){var curr=data[i].latlng,prev=i>0?data[i-1].latlng:curr,delta=curr.distanceTo(prev)*this._distanceFactor;speed=Math.abs(delta/deltaT*this._timeFactor)*this._speedFactor}if(this.options.speedDeltaMax){var deltaS=i>0?speed-data[i-1].speed:0,maxDeltaS=this.options.speedDeltaMax;Math.abs(deltaS)>maxDeltaS&&(speed=data[i-1].speed+maxDeltaS*Math.sign(deltaS))}if(this.options.speedRange){var range=this.options.speedRange;speed<range[0]?speed=range[0]:speed>range[1]&&(speed=range[1])}sMax=(speed=L.Util.formatNum(speed,2))>sMax?speed:sMax,sMin=speed<sMin?speed:sMin,sAvg=(speed+sAvg)/2,data[i].speed=speed,this.track_info.speed_max=this._maxSpeed=sMax,this.track_info.speed_min=this._minSpeed=sMin,this.track_info.speed_avg=this._avgSpeed=sAvg})),this.options.speed&&(this.on("elechart_change",(function(e){var item=e.data,chart=this._chart,marker=this._marker;chart._focuslabel&&(chart._focuslabelSpeed&&chart._focuslabelSpeed.property("isConnected")||(chart._focuslabelSpeed=chart._focuslabel.select("text").insert("svg:tspan",".mouse-focus-label-x").attr("class","mouse-focus-label-speed").attr("dy","1.5em")),chart._focuslabelSpeed.text(item.speed+" "+speed.label),chart._focuslabel.select(".mouse-focus-label-x").attr("dy","1.5em")),marker._focuslabel&&(chart._mouseSpeedFocusLabel||(chart._mouseSpeedFocusLabel=marker._focuslabel.append("svg:tspan").attr("class","height-focus-speed ")),chart._mouseSpeedFocusLabel.attr("dy","1.5em").text(Math.round(item.speed)+" "+speed.label),marker._focuslabel.select(".height-focus-y").attr("dy","-1.5em"))})),this.on("elechart_summary",(function(){this.track_info.speed_max=this._maxSpeed||0,this.track_info.speed_min=this._minSpeed||0,this._summary.append("minspeed",L._("Min Speed: "),Math.round(this.track_info.speed_min)+"&nbsp;"+speed.label).append("maxspeed",L._("Max Speed: "),Math.round(this.track_info.speed_max)+"&nbsp;"+speed.label).append("avgspeed",L._("Avg Speed: "),Math.round(this.track_info.speed_avg)+"&nbsp;"+speed.label)}))),this.on("eledata_clear",(function(){this._maxSpeed=null,this._minSpeed=null}))}})),Elevation.addInitHook((function(){if(this.options.acceleration){var opts=this.options,acceleration={};acceleration.label=opts.accelerationLabel||L._(this.options.imperial?"ft/s":"m/s"),this._accelerationFactor=opts.accelerationFactor||1,"summary"!=this.options.acceleration&&(this.on("elechart_init",(function(){acceleration.path=this._chart._area.append("path").style("pointer-events","none").attr("fill","#050402").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")})),this.on("elechart_axis",(function(){acceleration.x=this._chart._x,acceleration.y=Scale({data:this._data,range:[this._height(),0],attr:"acceleration",min:0,max:1,forceBounds:opts.forceAxisBounds}),acceleration.axis=Axis({axis:"y",position:"right",width:this._width(),height:this._height(),scale:acceleration.y,ticks:this.options.yTicks,tickPadding:16,label:acceleration.label,labelX:25,labelY:-8,name:"acceleration"}),this._chart._axis.call(acceleration.axis)})),this.on("elechart_area",(function(){acceleration.area=Area({interpolation:opts.sInterpolation,data:this._data,name:"Acceleration",xAttr:opts.xAttr,yAttr:"acceleration",width:this._width(),height:this._height(),scaleX:acceleration.x,scaleY:acceleration.y}),acceleration.path.call(acceleration.area)})),this.on("elechart_legend",(function(){acceleration.legend=this._chart._legend.append("g").call(LegendItem({name:"Acceleration",width:this._width(),height:this._height(),margins:this.options.margins})),acceleration.legend.select("rect").classed("area",!1).attr("fill","#03ffff").attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25")}))),this.on("elepoint_added",(function(e){var data=this._data,i=e.index,currT=data[i].time,prevT,deltaT=(currT-(i>0?data[i-1].time:currT))/1e3,sMax=this._maxAcceleration||-1/0,sMin=this._minAcceleration||1/0,sAvg=this._avgAcceleration||0,acceleration=0;if(deltaT>0){var curr=data[i].speed,prev,delta=(curr-(i>0?data[i-1].speed:curr))*(1e3/this._timeFactor);acceleration=Math.abs(delta/deltaT)*this._accelerationFactor}if(this.options.accelerationDeltaMax){var deltaA=i>0?acceleration-data[i-1].acceleration:0,maxDeltaS=this.options.accelerationDeltaMax;Math.abs(deltaA)>maxDeltaS&&(acceleration=data[i-1].acceleration+maxDeltaS*Math.sign(deltaA))}if(this.options.accelerationRange){var range=this.options.accelerationRange;acceleration<range[0]?acceleration=range[0]:acceleration>range[1]&&(acceleration=range[1])}sMax=(acceleration=L.Util.formatNum(acceleration,2))>sMax?acceleration:sMax,sMin=acceleration<sMin?acceleration:sMin,sAvg=(acceleration+sAvg)/2,data[i].acceleration=acceleration,this.track_info.acceleration_max=this._maxAcceleration=sMax,this.track_info.acceleration_min=this._minAcceleration=sMin,this.track_info.acceleration_avg=this._avgAcceleration=sAvg})),this.on("elechart_change",(function(e){var item=e.data,chart=this._chart,marker=this._marker;chart._focuslabel&&(chart._focuslabelAcceleration&&chart._focuslabelAcceleration.property("isConnected")||(chart._focuslabelAcceleration=chart._focuslabel.select("text").insert("svg:tspan",".mouse-focus-label-x").attr("class","mouse-focus-label-acceleration").attr("dy","1.5em")),chart._focuslabelAcceleration.text(item.acceleration+" "+acceleration.label),chart._focuslabel.select(".mouse-focus-label-x").attr("dy","1.5em")),marker._focuslabel&&(chart._mouseAccelerationFocusLabel||(chart._mouseAccelerationFocusLabel=marker._focuslabel.append("svg:tspan").attr("class","height-focus-acceleration ")),chart._mouseAccelerationFocusLabel.attr("dy","1.5em").text(Math.round(item.acceleration)+" "+acceleration.label),marker._focuslabel.select(".height-focus-y").attr("dy","-1.5em"))})),this.on("elechart_summary",(function(){this.track_info.acceleration_max=this._maxAcceleration||0,this.track_info.acceleration_min=this._minAcceleration||0,this._summary.append("minacceleration",L._("Min Acceleration: "),Math.round(this.track_info.acceleration_min)+"&nbsp;"+acceleration.label).append("maxacceleration",L._("Max Acceleration: "),Math.round(this.track_info.acceleration_max)+"&nbsp;"+acceleration.label).append("avgacceleration",L._("Avg Acceleration: "),Math.round(this.track_info.acceleration_avg)+"&nbsp;"+acceleration.label)})),this.on("eledata_clear",(function(){this._maxAcceleration=null,this._minAcceleration=null}))}})),Elevation.Utils=_,Elevation.Components=D3,Elevation.Chart=Chart,L.control.elevation=function(options){return new Elevation(options)}}));
//# sourceMappingURL=leaflet-elevation.min.js.map