!function(window,document,$,undefined){"use strict";var numberOfboxes=document.querySelectorAll("[id^=multifotobox]").length;if(numberOfboxes>0&&"function"==typeof Slider){var{phpvars:phpvars,mobile:mobile}=defGenVar();let numberOfFotorama=document.querySelectorAll("[id^=mfotorama]").length,allSliders=new Array;var{numberOfMaps:numberOfMaps,chartheight:chartheight,phpmapheight:phpmapheight,maxZoomValue:maxZoomValue,zpadding:zpadding,mrk:mrk,storemarker:storemarker,newmarker:newmarker}=defMapVar();if(numberOfMaps>0)var{opts:opts,layer1:layer1,layer2:layer2,layer3:layer3,layer4:layer4,baseLayers:baseLayers,maps:maps,showalltracks:showalltracks,controlZoom:controlZoom,bounds:bounds,scale:scale,controlLayer:controlLayer,baseLayers2:baseLayers2,eleopts:eleopts,controlLayer2:controlLayer2,controlElevation:controlElevation,traces:traces,tracks:tracks,grouptracks:grouptracks,myIcon2:myIcon2,group1:group1,myIcon1:myIcon1,myIcon3:myIcon3}=defMapAndChartVar(numberOfMaps,setIcon);for(var m=0;m<numberOfboxes;m++){phpvars[m]=eval("wpfm_phpvars"+m);var hasFotorama=1==document.querySelectorAll("[id^=mfotorama"+m+"]").length;hasFotorama&&(allSliders[m]=new Slider(m,"mfotorama"+m),allSliders[m].defSlider());var hasMap=1==document.querySelectorAll("[id^=boxmap"+m+"]").length;if(hasMap){var phptracks=defMapAndChart(chartheight,phpmapheight,hasFotorama,maxZoomValue,mobile),mylocale=setlang();if(maps[m]=new L.Map("map"+m,opts.map),showSelectedMap(numberOfMaps,phpvars),setMapControls(mobile,phptracks,zpadding),parseInt(phptracks.ngpxfiles)>0)if(createElevChart(phptracks),parseInt(phptracks.ngpxfiles)>1&&!0===showalltracks){var i,track;({i:i,track:track,zpadding:zpadding}=showMultipleTracks(zpadding))}else{var i=0;for(var track in tracks[m])loadTrace(m,track,i++)}else hasFotorama||L.marker(opts.map.center,{title:phptracks.markertext,icon:myIcon2}).addTo(maps[m]);if(hasFotorama){var{marker:marker,j:j,testgroup:testgroup}=createMarkers(phptracks,allSliders);marker.length>0?(mrk[m]=marker,controlLayer[m].addOverlay(group1[m],L._("Images")+"("+j+")"),group1[m].addTo(maps[m]),bounds[m]=setBoundsToMarkers(m,testgroup)):bounds[m]=maps[m].getBounds()}else 0==parseInt(phptracks.ngpxfiles)&&(bounds[m]=maps[m].getBounds());maps[m].on("baselayerchange",(function(e){let ename=e.name,mapchange=!1,source=e.sourceTarget._container.id;source=source.replace("map",""),m=parseInt(source);for(const[key,value]of Object.entries(baseLayers[m]))ename==key&&(mapchange=!0);if(!mapchange)for(var i in traces[m])if(traces[m][i].gpx._leaflet_id==e.layer._leaflet_id){setElevationTrace(m,e.layer.options.index);break}}))}}numberOfFotorama>0&&$(".fotorama").on("sliderload sliderchange",(function(e){let nr=e.originalEvent.detail.newslide-1,m=e.originalEvent.detail.slider,hasMap;1==document.querySelectorAll("[id^=boxmap"+m+"]").length&&phpvars[m].imgdata[nr].coord[0]&&("sliderload"===e.type&&(storemarker[m]=mrk[m][nr],newmarker[m]=mrk[m][nr],maps[m].removeLayer(mrk[m][nr]),newmarker[m].setIcon(myIcon3),newmarker[m].setZIndexOffset(500),newmarker[m].addTo(maps[m])),"sliderchange"===e.type&&maps[m].flyTo([phpvars[m].imgdata[nr].coord[0],phpvars[m].imgdata[nr].coord[1]]),storemarker[m].options.id!=mrk[m][nr].options.id&&(maps[m].removeLayer(newmarker[m]),storemarker[m].setIcon(myIcon1),newmarker[m].setZIndexOffset(-500),storemarker[m].addTo(maps[m]),storemarker[m]=mrk[m][nr],newmarker[m]=mrk[m][nr],maps[m].removeLayer(mrk[m][nr]),newmarker[m].setIcon(myIcon3),newmarker[m].setZIndexOffset(500),newmarker[m].addTo(maps[m])))})),$(window).on("resize load",mapResize())}function showMultipleTracks(zpadding){var routes;grouptracks[m=0]=[];var i=0;for(var track in zpadding=[0,0],tracks[m])grouptracks[m][i]=tracks[m][track].url,i++;return(routes=L.gpxGroup(grouptracks[m],{elevation:!0,elevation_options:eleopts[m].elevationControl.options,legend:!0,legend_options:{position:"bottomright",collapsed:!0},distanceMarkers:!1})).addTo(maps[m]),window.setTimeout((function(e){var b=routes.bounds;maps[0].fitBounds([[b._northEast.lat,b._northEast.lng],[b._southWest.lat,b._southWest.lng]]),maps[0].zoomOut(1),bounds[0]=maps[0].getBounds();var elem1=document.getElementsByClassName("leaflet-control-layers-base")[1].children[0].childNodes[0],elem2=document.getElementsByClassName("leaflet-control-layers-base")[1].children[1].childNodes[0];elem1.click(),elem2.click(),elem1.click()}),1e3),maps[0].on("eledata_loaded eledata_added eledata_clear",(function(){m=0;const targetNode=document.getElementsByClassName("leaflet-bottom")[1],config={childList:!0,subtree:!0,attributes:!0},callback=function(){let div=document.getElementsByClassName("leaflet-control-layers-base"),len=div[1].childElementCount,track="",keyarray=Object.keys(routes._routes);for(var c=0;c<len;c++){let child=div[1].children[c].children[0].children[1],style=child.attributes.style;style&&(style=child.attributes.style.nodeValue,style.search("font-weight")>-1&&(track=child.innerText,track=track.trim()))}keyarray.forEach(key=>{let info=routes._routes[key]._info.desc,name=routes._routes[key]._info.name,q=document.querySelector.bind(document);name==track&&(info=info?info.split(" "):"",info[1]&&info[4]&&info[7]?(q("#data-summary"+m+" .totlen .summarylabel").innerHTML=L._("Distance")+": ",q("#data-summary"+m+" .totlen .summaryvalue").innerHTML=info[1]+" km",q("#data-summary"+m+" .gain .summarylabel").innerHTML=L._("Ascent")+": ",q("#data-summary"+m+" .gain .summaryvalue").innerHTML=info[4]+" m",q("#data-summary"+m+" .loss .summarylabel").innerHTML=L._("Descent")+": ",q("#data-summary"+m+" .loss .summaryvalue").innerHTML=info[7]+" m"):(q("#data-summary"+m+" .totlen .summarylabel").innerHTML=L._("Distance")+": ",q("#data-summary"+m+" .totlen .summaryvalue").innerHTML=(trace.gpx.get_distance()/1e3).toFixed(2)+" km",q("#data-summary"+m+" .gain .summarylabel").innerHTML=L._("Ascent")+": ",q("#data-summary"+m+" .gain .summaryvalue").innerHTML=trace.gpx.get_elevation_gain().toFixed(0)+" m",q("#data-summary"+m+" .loss .summarylabel").innerHTML=L._("Descent")+": ",q("#data-summary"+m+" .loss .summaryvalue").innerHTML=trace.gpx.get_elevation_loss().toFixed(0)+" m"))})},observer=new MutationObserver(callback);observer.observe(targetNode,config)})),{i:i,track:track,zpadding:zpadding}}function createElevChart(phptracks){eleopts[m]={elevationControl:{options:{theme:phptracks.eletheme,elevationDiv:"#elevation-div"+m,detachedView:!0,summary:!1,downloadLink:!1,followMarker:!1,skipNullZCoords:!0,legend:!0,lazyLoadJS:!0,loadData:{defer:!0,lazy:!0},margins:{top:10,right:20,bottom:10,left:50}}}},!1===showalltracks&&(controlLayer2[m]=L.control.layers(baseLayers2[m],null,{collapsed:!0}),controlLayer2[m].setPosition("bottomright"),controlLayer2[m].addTo(maps[m]),controlElevation[m]=L.control.elevation(eleopts[m].elevationControl.options),controlElevation[m].addTo(maps[m]),controlElevation[m].loadChart(maps[m])),traces[m]=[],tracks[m]=phptracks.tracks}function createMarkers(phptracks,allSliders){group1[m]=L.layerGroup();let testgroup=L.featureGroup(),marker=new Array,j=0;return phptracks.imgdata.forEach(tour=>{if(null==tour.coord[0]||null==tour.coord[1]);else{if(marker.push(new L.Marker(tour.coord,{title:tour.title,icon:myIcon1,id:j,riseOnHover:!0})),"srcset"in tour&&Object.keys(tour.srcset).length){var key=Object.keys(tour.srcset)[0];marker[j].bindPopup("<div>"+tour.title+'<br><img class="leaf_pup_img" src="'+tour.srcset[key]+'"></div>',{maxWidth:"auto"})}else marker[j].bindPopup(tour.title);marker[j].addTo(group1[m]),marker[j].on("click",(function(a){var source=a.originalEvent.currentTarget.id;source=source.replace("map",""),m=parseInt(source),allSliders[m].setSliderIndex(this.options.id)})),marker[j].on("mouseover",(function(e){this.openPopup()})),marker[j].on("mouseout",(function(e){this.closePopup()})),marker[j].addTo(testgroup),j++}}),{marker:marker,j:j,testgroup:testgroup}}function setMapControls(mobile,phptracks,zpadding){mobile||(controlZoom[m]=new L.Control.Zoom(opts.zoomControl),controlZoom[m].addTo(maps[m])),L.control.fullscreen({position:"topleft",title:L._("Show fullscreen"),titleCancel:L._("Exit fullscreen"),content:null,forceSeparateButton:!0,forcePseudoFullscreen:!0,fullscreenElement:!1}).addTo(maps[m]),L.Control.Watermark=L.Control.extend({onAdd:function(){let img=L.DomUtil.create("img");return img.src=phptracks.imagepath+"/lupe_p_32.png",img.style.background="white",img.style.width="32px",img.style.height="32px",img.style.cursor="pointer",img.title=L._("Show all"),img.id=m,img.onclick=function(e){let m=parseInt(e.srcElement.id);maps[m].fitBounds(bounds[m],{padding:zpadding,maxZoom:13})},img}}),L.control.watermark=function(opts){return new L.Control.Watermark(opts)},L.control.watermark({position:"topleft"}).addTo(maps[m]),scale[m]=L.control.scale(),scale[m].addTo(maps[m]),controlLayer[m]=L.control.layers(baseLayers[m],null,opts.layersControl.options),controlLayer[m].addTo(maps[m]),baseLayers2[m]={}}function showSelectedMap(numberOfMaps,phpvars){1==numberOfMaps&&showalltracks?maps[m].addLayer(baseLayers[m].OpenStreetMap):"OpenStreetMap"===phpvars[m].mapselector?maps[m].addLayer(baseLayers[m].OpenStreetMap):"OpenTopoMap"===phpvars[m].mapselector?maps[m].addLayer(baseLayers[m].OpenTopoMap):"CycleOSM"===phpvars[m].mapselector?maps[m].addLayer(baseLayers[m].CycleOSM):"Satellit"===phpvars[m].mapselector?maps[m].addLayer(baseLayers[m].Satellit):maps[m].addLayer(baseLayers[m].OpenStreetMap)}function defMapAndChart(chartheight,phpmapheight,hasFotorama,maxZoomValue,mobile){let phptracks=eval("wpfm_phpvars"+m);return chartheight[m]=phptracks.chartheight,phpmapheight[m]=phptracks.mapheight,0!=parseInt(phptracks.ngpxfiles)||hasFotorama||(opts.map.center=phptracks.mapcenter,opts.map.zoom=phptracks.zoom),layer1[m]=new L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:maxZoomValue,attribution:'MapData &copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | MapStyle:&copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}),layer2[m]=new L.tileLayer("https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/ {y}.png",{maxZoom:maxZoomValue,attribution:'MapData &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),layer3[m]=new L.tileLayer("https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",{maxZoom:maxZoomValue,attribution:'MapData &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),layer4[m]=new L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:maxZoomValue,attribution:"Tiles &copy; Esri &mdash; Source: Esri User Community"}),mobile&&(layer1[m].options.attribution=layer2[m].options.attribution,layer3[m].options.attribution=layer2[m].options.attribution,layer4[m].options.attribution=layer2[m].options.attribution),baseLayers[m]={OpenStreetMap:layer2[m],OpenTopoMap:layer1[m],CycleOSM:layer3[m],Satellit:layer4[m]},phptracks}function loadTrace(m,track,i){let trace={},filename=tracks[m][track].url.split("/").pop().split("#")[0].split("?")[0];trace.gpx=new L.GPX(tracks[m][track].url,{async:!0,index:i,marker_options:{wptIconUrls:{"":wpfm_phpvars0.imagepath+"pin-icon-wpt.png"},startIconUrl:null,endIconUrl:null,shadowUrl:null},polyline_options:{color:"blue"}}),trace.gpx.on("error",(function(e){console.log("Error loading file: "+e.err)})),trace.gpx.on("loaded",(function(e){trace.gpx._info.name=filename,controlLayer2[m].addBaseLayer(e.target,e.target.get_name()),0==e.target.options.index?(setElevationTrace(m,0),bounds[m]=trace.gpx.getBounds()):maps[m].removeLayer(e.target)})),trace.gpx.on("addline",(function(e){trace.line=e.line})),trace.gpx.addTo(maps[m]),traces[m].push(trace)}function setElevationTrace(m,index){let trace=traces[m][index];controlElevation[m].clear();let q=document.querySelector.bind(document);controlElevation[m].addData(trace.line),maps[m].fitBounds(trace.gpx.getBounds(),{padding:zpadding}),bounds[m]=trace.gpx.getBounds(),trace.gpx.setStyle({color:"blue",weight:4,opacity:.8});var info=trace.gpx._info.desc;"Dist:"==(info=info?info.split(" "):"")[0]&&info[1]&&info[4]&&info[7]?(q("#data-summary"+m+" .totlen .summarylabel").innerHTML=L._("Distance")+": ",q("#data-summary"+m+" .totlen .summaryvalue").innerHTML=info[1]+" km",q("#data-summary"+m+" .gain .summarylabel").innerHTML=L._("Ascent")+": ",q("#data-summary"+m+" .gain .summaryvalue").innerHTML=info[4]+" m",q("#data-summary"+m+" .loss .summarylabel").innerHTML=L._("Descent")+": ",q("#data-summary"+m+" .loss .summaryvalue").innerHTML=info[7]+" m"):(q("#data-summary"+m+" .totlen .summarylabel").innerHTML=L._("Distance")+": ",q("#data-summary"+m+" .totlen .summaryvalue").innerHTML=(trace.gpx.get_distance()/1e3).toFixed(2)+" km",q("#data-summary"+m+" .gain .summarylabel").innerHTML=L._("Ascent")+": ",q("#data-summary"+m+" .gain .summaryvalue").innerHTML=trace.gpx.get_elevation_gain().toFixed(0)+" m",q("#data-summary"+m+" .loss .summarylabel").innerHTML=L._("Descent")+": ",q("#data-summary"+m+" .loss .summaryvalue").innerHTML=trace.gpx.get_elevation_loss().toFixed(0)+" m")}function setBoundsToMarkers(mapNumber,markergroup){let _bounds=[];if(void 0!==bounds[mapNumber]&&"_northEast"in bounds[mapNumber]&&"_southWest"in bounds[mapNumber])_bounds=bounds[mapNumber];else try{_bounds=markergroup.getBounds().pad(.1)}catch(e){}if(0!==_bounds.length){let curzoom;maps[mapNumber].fitBounds(_bounds),maps[mapNumber].getZoom()==maxZoomValue&&maps[mapNumber].fitBounds(_bounds,{maxZoom:13})}return _bounds}function setlang(){let de={"Show all":"Alles anzeigen",Distance:"Strecke",Ascent:"Anstieg",Descent:"Abstieg",Altitude:"Höhe",Images:"Fotos","Show fullscreen":"Zeige Vollbild","Exit fullscreen":"Vollbild beenden"},it={"Show all":"Mostra Tutti",Distance:"Distanza",Ascent:"Salita",Descent:"Discesa",Altitude:"Altitudine",Images:"Foto","Show fullscreen":"Mappa a schermo intero","Exit fullscreen":"Esci schermo intero"},fr={"Show all":"Afficher Tout",Distance:"Distance",Ascent:"Ascente",Descent:"Descente",Altitude:"Altitude",Images:"Images","Show fullscreen":"Afficher carte en plein écran","Exit fullscreen":"Quitter le mode plein écran"},es={"Show all":"Mostrar Todo",Distance:"Distancia",Ascent:"Ascenso",Descent:"Descenso",Altitude:"Altura",Images:"Fotos","Show fullscreen":"Mostrar pantalla completa","Exit fullscreen":"Salir de pantalla completa"};var lang=navigator.language;return lang=lang.split("-")[0],"de"==lang||"it"==lang||"fr"==lang||"es"==lang?(L.registerLocale(lang,eval(lang)),L.setLocale(lang),mylocale):void 0}function setIcon(path,iconpng,shadowpng){let icon;return L.icon({iconUrl:path+iconpng,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-16],shadowUrl:path+shadowpng,shadowSize:[48,32],shadowAnchor:[16,32]})}function mapResize(){let fotowidth;$("[id^=mfotorama]").width()<480?$(".fotorama__caption__wrapm, .fotorama__caption").hide():$(".fotorama__caption__wrapm, .fotorama__caption").show();for(let m=0;m<numberOfboxes;m++){let wbox=$("#boxmap"+m).width(),wmap,hmap,ratioMap=$("#map"+m).width()/$("#map"+m).height();"ratioMap"in phpvars[m]||(phpvars[m].ratioMap=ratioMap,$("#map"+m).css("aspect-ratio",ratioMap));let hele=$("#elevation-div"+m).height();hele=void 0===hele?0:hele;let hsum=$("#data-summary"+m).height();hsum=void 0===hsum?0:hsum;let hdld=$("#boxmap"+m+" .fm-dload").height();hdld=void 0===hdld?0:hdld;let eleheight=wbox/3;eleheight=Math.min(Math.max(parseInt(eleheight),140),chartheight[m]),$("#elevation-div"+m).css("height",eleheight);let mapheight=wbox/phpvars[m].ratioMap;mapheight=Math.min(Math.max(parseInt(mapheight),280),phpmapheight[m]),$("#map"+m).css("height",mapheight);let _group=new L.featureGroup(mrk[m]);isNaN(ratioMap)||(bounds[m]=setBoundsToMarkers(m,_group))}}function defMapAndChartVar(numberOfMaps,setIcon){var showalltracks="true"===wpfm_phpvars0.showalltracks;numberOfMaps>1&&showalltracks&&(showalltracks=!1);var myIcon1=setIcon(wpfm_phpvars0.imagepath,"photo.png","shadow.png"),myIcon2=setIcon(wpfm_phpvars0.imagepath,"pin-icon-wpt.png","shadow.png"),myIcon3=setIcon(wpfm_phpvars0.imagepath,"active.png","shadow.png"),opts={map:{center:[41.4583,12.7059],zoom:5,markerZoomAnimation:!1,zoomControl:!1,gestureHandling:!0},zoomControl:{position:"topleft"},layersControl:{options:{collapsed:!0}}},maps=new Array,baseLayers=new Array,layer1=new Array,layer2=new Array,layer3=new Array,layer4=new Array,bounds=new Array,controlZoom=new Array,scale=new Array,controlLayer=new Array,baseLayers2=new Array,controlLayer2=new Array,controlElevation=new Array,eleopts,traces,tracks,grouptracks,group1;return{opts:opts,layer1:layer1,layer2:layer2,layer3:layer3,layer4:layer4,baseLayers:baseLayers,maps:maps,showalltracks:showalltracks,controlZoom:controlZoom,bounds:bounds,scale:scale,controlLayer:controlLayer,baseLayers2:baseLayers2,eleopts:new Array,controlLayer2:controlLayer2,controlElevation:controlElevation,traces:new Array,tracks:new Array,grouptracks:[],myIcon2:myIcon2,group1:new Array,myIcon1:myIcon1,myIcon3:myIcon3}}function defMapVar(){var numberOfMaps=document.querySelectorAll("[id^=boxmap]").length,storemarker=new Array,newmarker=new Array,mrk=new Array,chartheight,phpmapheight,maxZoomValue=19,zpadding;return{numberOfMaps:numberOfMaps,chartheight:new Array,phpmapheight:new Array,maxZoomValue:19,zpadding:[30,30],mrk:mrk,storemarker:storemarker,newmarker:newmarker}}function defGenVar(){var mobile=/iphone|ipod|android|webos|ipad|iemobile|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()),phpvars;return{phpvars:new Array,mobile:mobile}}}(window,document,jQuery);
//# sourceMappingURL=fotorama-multi-reduced.min.js.map