"use strict";!function(window,document,undefined){var numberOfFotorama=document.querySelectorAll("[id^=mfotorama]").length,numberOfMaps=document.querySelectorAll("[id^=boxmap]").length;let mobile=/iphone|ipod|android|webos|ipad|iemobile|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase());for(var mapdiv=new Array,phpvars=new Array,circlemarker=new Array,storemarker,newmarker,myIcon1=L.icon({iconUrl:wpfm_phpvars0.imagepath+"photo.png",iconSize:[48,48],iconAnchor:[24,48],popupAnchor:[0,-24],shadowUrl:wpfm_phpvars0.imagepath+"shadow.png",shadowSize:[72,48],shadowAnchor:[24,48]}),myIcon2=L.icon({iconUrl:wpfm_phpvars0.imagepath+"circle-big.png",iconSize:[48,48],iconAnchor:[24,24],keyboard:!1,interactive:!1}),myIcon3=L.icon({iconUrl:wpfm_phpvars0.imagepath+"active.png",iconSize:[48,48],iconAnchor:[24,48],popupAnchor:[0,-24],shadowUrl:wpfm_phpvars0.imagepath+"shadow.png",shadowSize:[72,48],shadowAnchor:[24,48]}),i=0;i<numberOfFotorama;i++){var $fotoramaDiv=jQuery("#mfotorama"+i).fotorama(),fotorama=eval("mfotorama"+i);fotorama=$fotoramaDiv.data("fotorama");var mapdiv=document.getElementById("map"+i);if(phpvars[i]=eval("wpfm_phpvars"+i),fotorama){let newimages=phpvars[i].imgdata,olddata=fotorama.data,newdata=[];var width=$fotoramaDiv[0].parentElement.clientWidth;if(newimages[0].srcset&&olddata.length==newimages.length){var srcarray=newimages[0].srcset;let srcindex=0;for(const[key,value]of Object.entries(srcarray))if(key>width){srcindex=key;break}function replaceimg(item,index){newdata[index]=mobile?{img:newimages[index].srcset[srcindex],thumb:item.thumb,caption:item.caption}:{img:newimages[index].srcset[srcindex],thumb:item.thumb,full:newimages[index].srcset[2560],caption:item.caption}}olddata.forEach(replaceimg)}fotorama.load(newdata)}}jQuery(".fotorama").on("fotorama:showend fotorama:load",(function(e,fotorama,extra){var nr=fotorama.activeIndex,source=e.currentTarget.id;source=source.replace("mfotorama",""),m=parseInt(source),circlemarker[m]&&maps[m].removeLayer(circlemarker[m]),maps[m]&&phpvars[m].imgdata[nr].coord[0]&&("fotorama:load"===e.type&&(storemarker=marker[nr],newmarker=marker[nr],maps[m].removeLayer(marker[nr]),newmarker.setIcon(myIcon3),newmarker.addTo(maps[m])),"fotorama:showend"===e.type&&maps[m].flyTo([phpvars[m].imgdata[nr].coord[0],phpvars[m].imgdata[nr].coord[1]]),storemarker.options.id!=marker[nr].options.id&&(maps[m].removeLayer(newmarker),storemarker.setIcon(myIcon1),storemarker.addTo(maps[m]),storemarker=marker[nr],newmarker=marker[nr],maps[m].removeLayer(marker[nr]),newmarker.setIcon(myIcon3),newmarker.addTo(maps[m])))})),jQuery(".fotorama").on("fotorama:fullscreenenter fotorama:fullscreenexit",(function(e,fotorama){"fotorama:fullscreenenter"===e.type?fotorama.setOptions({fit:"contain"}):fotorama.setOptions({fit:"cover"})}));var opts={map:{center:[41.4583,12.7059],zoom:5,markerZoomAnimation:!1,zoomControl:!1,gestureHandling:!0,gestureHandlingOptions:{text:{touch:"Use two Fingers to move the Map",scroll:"Use Ctrl + Scrollwheel to zoom the Map",scrollMac:"use âŒ˜ + scroll to zoom the map"}}},zoomControl:{position:"topleft"},layersControl:{options:{collapsed:!0}}},maps=new Array,baseLayers=new Array,layer1=new Array,layer2=new Array,layer3=new Array,layer4=new Array,bounds=new Array,controlZoom=new Array,scale=new Array,controlLayer=new Array,baseLayers2=new Array,controlLayer2=new Array,controlElevation=new Array,eleopts=new Array,traces=new Array;let tracks=new Array,lupe=new Array;for(var m=0;m<numberOfMaps;m++){var phptracks=eval("wpfm_phpvars"+m);if(layer1[m]=new L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'MapData:&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | MapStyle:&copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}),layer2[m]=new L.tileLayer("http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/ {y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),layer3[m]=new L.tileLayer("https://tiles.wmflabs.org/hikebike/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),layer4[m]=new L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles &copy; Esri &mdash; Source: Esri User Community"}),mobile&&(layer1[m].options.attribution=layer2[m].options.attribution,layer3[m].options.attribution=layer2[m].options.attribution,layer4[m].options.attribution=layer2[m].options.attribution),baseLayers[m]={OpenStreetMap:layer2[m],OpenTopoMap:layer1[m],"Bike-Hike-Map":layer3[m],Satellit:layer4[m]},maps[m]=new L.Map("map"+m,opts.map),maps[m].addLayer(baseLayers[m].OpenStreetMap),bounds[m]=maps[m].getBounds,mobile||(controlZoom[m]=new L.Control.Zoom(opts.zoomControl),controlZoom[m].addTo(maps[m])),L.Control.Watermark=L.Control.extend({onAdd:function(){var img=L.DomUtil.create("img");return img.src=phptracks.imagepath+"/lupe_p_32.png",img.style.background="white",img.style.width="32px",img.style.height="32px",img.style.cursor="pointer",img.title="Alles anzeigen",img.id=m,img.onclick=function(e){var m=parseInt(e.srcElement.id);maps[m].fitBounds(bounds[m])},img}}),L.control.watermark=function(opts){return new L.Control.Watermark(opts)},L.control.watermark({position:"topleft"}).addTo(maps[m]),scale[m]=L.control.scale(),scale[m].addTo(maps[m]),controlLayer[m]=L.control.layers(baseLayers[m],null,opts.layersControl.options),controlLayer[m].addTo(maps[m]),baseLayers2[m]={},parseInt(phptracks.ngpxfiles)>0){controlLayer2[m]=L.control.layers(baseLayers2[m],null,{collapsed:!0}),controlLayer2[m].setPosition("bottomright"),controlLayer2[m].addTo(maps[m]),eleopts[m]={elevationControl:{options:{theme:"lime-theme",elevationDiv:"#elevation-div"+m,detachedView:!0,summary:!1,downloadLink:!1,followMarker:!1,skipNullZCoords:!0,legend:!0}}},controlElevation[m]=L.control.elevation(eleopts[m].elevationControl.options),controlElevation[m].addTo(maps[m]),controlElevation[m].loadChart(maps[m]),traces[m]=[],tracks[m]=phptracks.tracks;var i=0;for(var track in tracks[m])loadTrace(m,track,i++)}maps[m].on("baselayerchange",(function(e){var ename=e.name,mapchange=!1,source=e.sourceTarget._container.id;source=source.replace("map",""),m=parseInt(source);for(const[key,value]of Object.entries(baseLayers[m]))ename==key&&(mapchange=!0);if(!mapchange)for(var i in traces[m])if(traces[m][i].gpx._leaflet_id==e.layer._leaflet_id){setElevationTrace(m,e.layer.options.index);break}}));var group1=L.layerGroup(),marker=new Array,nposts=[0],j=0;phptracks.imgdata.forEach(tour=>{nposts[0]=nposts[0]+1;var key=Object.keys(tour.srcset)[0];marker.push(new L.Marker(tour.coord,{title:tour.title,icon:myIcon1,id:j})),marker[j].bindPopup(tour.title+'<br><img src="'+tour.srcset[key]+'">'),marker[j].addTo(group1),marker[j].on("click",(function(a){fotorama.show(this.options.id)})),marker[j].on("mouseover",(function(e){this.openPopup()})),marker[j].on("mouseout",(function(e){this.closePopup()})),j++}),controlLayer[m].addOverlay(group1,"Fotos ("+nposts[0]+")"),group1.addTo(maps[m])}function loadTrace(m,track,i){var trace={},filename=tracks[m][track].url.split("/").pop().split("#")[0].split("?")[0];trace.gpx=new L.GPX(tracks[m][track].url,{async:!0,index:i,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null},polyline_options:{color:"blue"}}),trace.gpx.on("error",(function(e){console.log("Error loading file: "+e.err)})),trace.gpx.on("loaded",(function(e){trace.gpx._info.name=filename,controlLayer2[m].addBaseLayer(e.target,e.target.get_name()),0==e.target.options.index?(setElevationTrace(m,0),bounds[m]=trace.gpx.getBounds()):maps[m].removeLayer(e.target)})),trace.gpx.on("addline",(function(e){trace.line=e.line})),trace.gpx.addTo(maps[m]),traces[m].push(trace)}function setElevationTrace(m,index){var trace=traces[m][index];controlElevation[m].clear();var q=document.querySelector.bind(document);controlElevation[m].addData(trace.line),maps[m].fitBounds(trace.gpx.getBounds()),bounds[m]=trace.gpx.getBounds(),trace.gpx.setStyle({color:"blue",weight:4,opacity:.8}),q("#data-summary"+m+" .totlen .summaryvalue").innerHTML=(trace.gpx.get_distance()/1e3).toFixed(2)+" km",q("#data-summary"+m+" .gain .summaryvalue").innerHTML="+"+trace.gpx.get_elevation_gain().toFixed(0)+" m",q("#data-summary"+m+" .loss .summaryvalue").innerHTML="-"+trace.gpx.get_elevation_loss().toFixed(0)+" m"}}(window,document);
//# sourceMappingURL=fotorama_multi.min.js.map